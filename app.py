import streamlit as st
from PIL import Image
import os
from datetime import datetime
import pandas as pd
import csv
import uuid
import base64
import requests
import json
import sqlite3
import hashlib
import re
import traceback
from functools import wraps

# Create directories for uploaded files if they don't exist
os.makedirs("uploads/photos", exist_ok=True)
os.makedirs("uploads/voice", exist_ok=True)
os.makedirs("uploads/notes", exist_ok=True)

# Language translations dictionary
LANGUAGES = {
    'English': {
        'app_title': 'ЁЯМ┐ PlantSpeak тАУ Preserve Plant Knowledge',
        'select_language': 'Select Language / рднрд╛рд╖рд╛ рдЪреБрдиреЗрдВ / р░нр░╛р░╖ р░Ор░Вр░Ър▒Бр░Хр▒Лр░Вр░бр░┐',
        'login': 'Login',
        'register': 'Register',
        'login_header': 'ЁЯФС Login to PlantSpeak',
        'register_header': 'ЁЯУЭ Create an Account',
        'username': 'Username',
        'password': 'Password',
        'confirm_password': 'Confirm Password',
        'full_name': 'Full Name (optional)',
        'email': 'Email (optional)',
        'role': 'Role (e.g., Farmer, Healer, Researcher)',
        'community': 'Community or Organization',
        'login_button': 'ЁЯФУ Login',
        'register_button': 'тЬЕ Register',
        'logout_button': 'ЁЯЪк Logout',
        'welcome': 'Welcome',
        'navigation': 'Navigation',
        'add_entry': 'ЁЯУЭ Add Entry',
        'view_submissions': 'ЁЯУЪ View Submissions',
        'my_profile': 'ЁЯСд My Profile',
        'invalid_credentials': 'Invalid username or password',
        'passwords_not_match': 'Passwords do not match',
        'password_too_short': 'Password must be at least 6 characters long',
        'username_required': 'Username and password are required',
        'registration_successful': 'Registration successful! Please login.',
        'username_exists': 'Username already exists',
        'email_exists': 'Email already exists',
        # Main form translations
        'app_main_title': 'ЁЯМ┐ PlantSpeak тАУ Help Us Preserve Traditional Plant Knowledge',
        'app_description': 'Many elders, farmers, and healers hold deep knowledge about local plants тАФ used in remedies, rituals, and daily life. This app helps collect, preserve, and share that knowledge.',
        'step1_header': 'ЁЯУе Step 1: Upload or Identify the Plant',
        'upload_photo': 'ЁЯУ╕ Upload a photo of the plant (leaf, flower, bark, etc.)',
        'plant_name_input': 'тЬНя╕П Enter the Name of the Plant (in any language)',
        'entry_title_input': 'ЁЯУЭ Entry Title (Optional)',
        'step2_header': 'ЁЯз╛ Step 2: Share What You Know',
        'local_names_input': '1я╕ПтГг Local Name(s) of the Plant',
        'scientific_name_input': '2я╕ПтГг Scientific / Botanical Name (Optional)',
        'category_select': '3я╕ПтГг Category of Use',
        'usage_desc_input': '4я╕ПтГг Describe the Use of the Plant',
        'prep_method_input': '5я╕ПтГг Explain the Preparation or Application Process',
        'community_input': '6я╕ПтГг Who Uses This Plant in Your Area?',
        'tags_input': 'ЁЯФЦ Tags or Keywords (Optional)',
        'step3_header': 'ЁЯМН Step 3: Location & Language',
        'location_input': '7я╕ПтГг Where is this Plant Found or Used?',
        'language_input': '8я╕ПтГг Language or Dialect You\'re Using',
        'step4_header': 'ЁЯОд Step 4: Voice & Text Extras',
        'voice_upload': '9я╕ПтГг Upload a Voice Recording',
        'notes_upload': 'ЁЯФа 10я╕ПтГг Upload Handwritten or Printed Notes',
        'step5_header': 'ЁЯСд Step 5: About You',
        'age_group_select': '1я╕ПтГг1я╕ПтГг Your Age Group',
        'submit_button': 'ЁЯУд Submit Your Contribution'
    },
    'рд╣рд┐рдВрджреА': {
        'app_title': 'ЁЯМ┐ рдкреНрд▓рд╛рдВрдЯрд╕реНрдкреАрдХ тАУ рдкрд╛рд░рдВрдкрд░рд┐рдХ рдкреМрдзреЛрдВ рдХрд╛ рдЬреНрдЮрд╛рди рд╕рдВрд░рдХреНрд╖рд┐рдд рдХрд░реЗрдВ',
        'select_language': 'рднрд╛рд╖рд╛ рдЪреБрдиреЗрдВ / Select Language / р░нр░╛р░╖ р░Ор░Вр░Ър▒Бр░Хр▒Лр░Вр░бр░┐',
        'login': 'рд▓реЙрдЧрд┐рди',
        'register': 'рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд░реЗрдВ',
        'login_header': 'ЁЯФС рдкреНрд▓рд╛рдВрдЯрд╕реНрдкреАрдХ рдореЗрдВ рд▓реЙрдЧрд┐рди рдХрд░реЗрдВ',
        'register_header': 'ЁЯУЭ рдЦрд╛рддрд╛ рдмрдирд╛рдПрдВ',
        'username': 'рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо',
        'password': 'рдкрд╛рд╕рд╡рд░реНрдб',
        'confirm_password': 'рдкрд╛рд╕рд╡рд░реНрдб рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░реЗрдВ',
        'full_name': 'рдкреВрд░рд╛ рдирд╛рдо (рд╡реИрдХрд▓реНрдкрд┐рдХ)',
        'email': 'рдИрдореЗрд▓ (рд╡реИрдХрд▓реНрдкрд┐рдХ)',
        'role': 'рднреВрдорд┐рдХрд╛ (рдЬреИрд╕реЗ рдХрд┐рд╕рд╛рди, рд╡реИрджреНрдп, рд╢реЛрдзрдХрд░реНрддрд╛)',
        'community': 'рд╕рдореБрджрд╛рдп рдпрд╛ рд╕рдВрдЧрдарди',
        'login_button': 'ЁЯФУ рд▓реЙрдЧрд┐рди',
        'register_button': 'тЬЕ рд░рдЬрд┐рд╕реНрдЯрд░',
        'logout_button': 'ЁЯЪк рд▓реЙрдЧрдЖрдЙрдЯ',
        'welcome': 'рд╕реНрд╡рд╛рдЧрдд рд╣реИ',
        'navigation': 'рдиреЗрд╡реАрдЧреЗрд╢рди',
        'add_entry': 'ЁЯУЭ рдирдИ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдЬреЛрдбрд╝реЗрдВ',
        'view_submissions': 'ЁЯУЪ рд╕рдмрдорд┐рд╢рди рджреЗрдЦреЗрдВ',
        'my_profile': 'ЁЯСд рдореЗрд░реА рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓',
        'invalid_credentials': 'рдЧрд▓рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдпрд╛ рдкрд╛рд╕рд╡рд░реНрдб',
        'passwords_not_match': 'рдкрд╛рд╕рд╡рд░реНрдб рдореЗрд▓ рдирд╣реАрдВ рдЦрд╛рддреЗ',
        'password_too_short': 'рдкрд╛рд╕рд╡рд░реНрдб рдХрдо рд╕реЗ рдХрдо 6 рдЕрдХреНрд╖рд░ рдХрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП',
        'username_required': 'рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдЖрд╡рд╢реНрдпрдХ рд╣реИ',
        'registration_successful': 'рдкрдВрдЬреАрдХрд░рдг рд╕рдлрд▓! рдХреГрдкрдпрд╛ рд▓реЙрдЧрд┐рди рдХрд░реЗрдВред',
        'username_exists': 'рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдкрд╣рд▓реЗ рд╕реЗ рдореМрдЬреВрдж рд╣реИ',
        'email_exists': 'рдИрдореЗрд▓ рдкрд╣рд▓реЗ рд╕реЗ рдореМрдЬреВрдж рд╣реИ',
        # Main form translations
        'app_main_title': 'ЁЯМ┐ рдкреНрд▓рд╛рдВрдЯрд╕реНрдкреАрдХ тАУ рдкрд╛рд░рдВрдкрд░рд┐рдХ рдкреМрдзреЛрдВ рдХреЗ рдЬреНрдЮрд╛рди рдХреЛ рд╕рдВрд░рдХреНрд╖рд┐рдд рдХрд░рдиреЗ рдореЗрдВ рд╣рдорд╛рд░реА рдорджрдж рдХрд░реЗрдВ',
        'app_description': 'рдХрдИ рдмреБрдЬреБрд░реНрдЧреЛрдВ, рдХрд┐рд╕рд╛рдиреЛрдВ рдФрд░ рд╡реИрджреНрдпреЛрдВ рдХреЗ рдкрд╛рд╕ рд╕реНрдерд╛рдиреАрдп рдкреМрдзреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЧрд╣рд░рд╛ рдЬреНрдЮрд╛рди рд╣реИ тАФ рдЬреЛ рдЙрдкрдЪрд╛рд░, рдЕрдиреБрд╖реНрдард╛рди рдФрд░ рджреИрдирд┐рдХ рдЬреАрд╡рди рдореЗрдВ рдЙрдкрдпреЛрдЧ рд╣реЛрддрд╛ рд╣реИред рдпрд╣ рдРрдк рдЙрд╕ рдЬреНрдЮрд╛рди рдХреЛ рдПрдХрддреНрд░, рд╕рдВрд░рдХреНрд╖рд┐рдд рдФрд░ рд╕рд╛рдЭрд╛ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред',
        'step1_header': 'ЁЯУе рдЪрд░рдг 1: рдкреМрдзреЗ рдХреА рддрд╕реНрд╡реАрд░ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ рдпрд╛ рдкрд╣рдЪрд╛рдиреЗрдВ',
        'upload_photo': 'ЁЯУ╕ рдкреМрдзреЗ рдХреА рддрд╕реНрд╡реАрд░ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ (рдкрддреНрддреА, рдлреВрд▓, рдЫрд╛рд▓, рдЖрджрд┐)',
        'plant_name_input': 'тЬНя╕П рдкреМрдзреЗ рдХрд╛ рдирд╛рдо рджрд░реНрдЬ рдХрд░реЗрдВ (рдХрд┐рд╕реА рднреА рднрд╛рд╖рд╛ рдореЗрдВ)',
        'entry_title_input': 'ЁЯУЭ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рд╢реАрд░реНрд╖рдХ (рд╡реИрдХрд▓реНрдкрд┐рдХ)',
        'step2_header': 'ЁЯз╛ рдЪрд░рдг 2: рдЕрдкрдирд╛ рдЬреНрдЮрд╛рди рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ',
        'local_names_input': '1я╕ПтГг рдкреМрдзреЗ рдХреЗ рд╕реНрдерд╛рдиреАрдп рдирд╛рдо',
        'scientific_name_input': '2я╕ПтГг рд╡реИрдЬреНрдЮрд╛рдирд┐рдХ / рд╡рдирд╕реНрдкрддрд┐ рдирд╛рдо (рд╡реИрдХрд▓реНрдкрд┐рдХ)',
        'category_select': '3я╕ПтГг рдЙрдкрдпреЛрдЧ рдХреА рд╢реНрд░реЗрдгреА',
        'usage_desc_input': '4я╕ПтГг рдкреМрдзреЗ рдХреЗ рдЙрдкрдпреЛрдЧ рдХрд╛ рд╡рд░реНрдгрди рдХрд░реЗрдВ',
        'prep_method_input': '5я╕ПтГг рддреИрдпрд╛рд░реА рдпрд╛ рдкреНрд░рдпреЛрдЧ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдмрддрд╛рдПрдВ',
        'community_input': '6я╕ПтГг рдЖрдкрдХреЗ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдпрд╣ рдкреМрдзрд╛ рдХреМрди рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ?',
        'tags_input': 'ЁЯФЦ рдЯреИрдЧ рдпрд╛ рдХреАрд╡рд░реНрдб (рд╡реИрдХрд▓реНрдкрд┐рдХ)',
        'step3_header': 'ЁЯМН рдЪрд░рдг 3: рд╕реНрдерд╛рди рдФрд░ рднрд╛рд╖рд╛',
        'location_input': '7я╕ПтГг рдпрд╣ рдкреМрдзрд╛ рдХрд╣рд╛рдБ рдкрд╛рдпрд╛ рдпрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ?',
        'language_input': '8я╕ПтГг рдЖрдкрдХреА рднрд╛рд╖рд╛ рдпрд╛ рдмреЛрд▓реА',
        'step4_header': 'ЁЯОд рдЪрд░рдг 4: рдЖрд╡рд╛рдЬ рдФрд░ рдкрд╛рда рдЕрддрд┐рд░рд┐рдХреНрдд',
        'voice_upload': '9я╕ПтГг рдЖрд╡рд╛рдЬ рдХреА рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ',
        'notes_upload': 'ЁЯФа 10я╕ПтГг рд╣рд╕реНрддрд▓рд┐рдЦрд┐рдд рдпрд╛ рдореБрджреНрд░рд┐рдд рдиреЛрдЯреНрд╕ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ',
        'step5_header': 'ЁЯСд рдЪрд░рдг 5: рдЖрдкрдХреЗ рдмрд╛рд░реЗ рдореЗрдВ',
        'age_group_select': '1я╕ПтГг1я╕ПтГг рдЖрдкрдХрд╛ рдЖрдпреБ рд╕рдореВрд╣',
        'submit_button': 'ЁЯУд рдЕрдкрдирд╛ рдпреЛрдЧрджрд╛рди рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВ'
    },
    'р░др▒Жр░▓р▒Бр░Чр▒Б': {
        'app_title': 'ЁЯМ┐ р░кр▒Нр░▓р░╛р░Вр░Яр▒НтАМр░╕р▒Нр░кр▒Ар░Хр▒Н тАУ р░╕р░╛р░Вр░кр▒Нр░░р░жр░╛р░п р░ор▒Кр░Хр▒Нр░Хр░▓ р░Ьр▒Нр░Юр░╛р░ир░╛р░ир▒Нр░ир░┐ р░нр░жр▒Нр░░р░кр░░р░Ър░Вр░бр░┐',
        'select_language': 'р░нр░╛р░╖ р░Ор░Вр░Ър▒Бр░Хр▒Лр░Вр░бр░┐ / Select Language / рднрд╛рд╖рд╛ рдЪреБрдиреЗрдВ',
        'login': 'р░▓р░╛р░Чр░┐р░ир▒Н',
        'register': 'р░░р░┐р░Ьр░┐р░╕р▒Нр░Яр░░р▒Н',
        'login_header': 'ЁЯФС р░кр▒Нр░▓р░╛р░Вр░Яр▒НтАМр░╕р▒Нр░кр▒Ар░Хр▒НтАМр░▓р▒Л р░▓р░╛р░Чр░┐р░ир▒Н р░Ър▒Зр░пр░Вр░бр░┐',
        'register_header': 'ЁЯУЭ р░Цр░╛р░др░╛ р░╕р▒Гр░╖р▒Нр░Яр░┐р░Вр░Ър░Вр░бр░┐',
        'username': 'р░╡р░┐р░ир░┐р░пр▒Лр░Чр░жр░╛р░░р▒Б р░кр▒Зр░░р▒Б',
        'password': 'р░кр░╛р░╕р▒НтАМр░╡р░░р▒Нр░бр▒Н',
        'confirm_password': 'р░кр░╛р░╕р▒НтАМр░╡р░░р▒Нр░бр▒Н р░ир░┐р░░р▒Нр░зр░╛р░░р░┐р░Вр░Ър░Вр░бр░┐',
        'full_name': 'р░кр▒Вр░░р▒Нр░др░┐ р░кр▒Зр░░р▒Б (р░Рр░Ър▒Нр░Ыр░┐р░Хр░В)',
        'email': 'р░Зр░ор▒Жр░пр░┐р░▓р▒Н (р░Рр░Ър▒Нр░Ыр░┐р░Хр░В)',
        'role': 'р░кр░╛р░др▒Нр░░ (р░Йр░жр░╛: р░░р▒Ир░др▒Б, р░╡р▒Ир░жр▒Нр░пр▒Бр░бр▒Б, р░кр░░р░┐р░╢р▒Лр░зр░Хр▒Бр░бр▒Б)',
        'community': 'р░╕р░ор░╛р░Ьр░В р░▓р▒Зр░жр░╛ р░╕р░Вр░╕р▒Нр░е',
        'login_button': 'ЁЯФУ р░▓р░╛р░Чр░┐р░ир▒Н',
        'register_button': 'тЬЕ р░░р░┐р░Ьр░┐р░╕р▒Нр░Яр░░р▒Н',
        'logout_button': 'ЁЯЪк р░▓р░╛р░Чр▒НтАМр░Ер░╡р▒Бр░Яр▒Н',
        'welcome': 'р░╕р▒Нр░╡р░╛р░Чр░др░В',
        'navigation': 'р░ир░╛р░╡р░┐р░Чр▒Зр░╖р░ир▒Н',
        'add_entry': 'ЁЯУЭ р░Хр▒Кр░др▒Нр░д р░Ор░Вр░Яр▒Нр░░р▒А р░Ьр▒Лр░бр░┐р░Вр░Ър░Вр░бр░┐',
        'view_submissions': 'ЁЯУЪ р░╕р░мр▒Нр░ор░┐р░╖р░ир▒Нр░▓р░ир▒Б р░Ър▒Вр░бр░Вр░бр░┐',
        'my_profile': 'ЁЯСд р░ир░╛ р░кр▒Нр░░р▒Кр░лр▒Ир░▓р▒Н',
        'invalid_credentials': 'р░др░кр▒Нр░кр▒Бр░бр▒Б р░╡р░┐р░ир░┐р░пр▒Лр░Чр░жр░╛р░░р▒Б р░кр▒Зр░░р▒Б р░▓р▒Зр░жр░╛ р░кр░╛р░╕р▒НтАМр░╡р░░р▒Нр░бр▒Н',
        'passwords_not_match': 'р░кр░╛р░╕р▒НтАМр░╡р░░р▒Нр░бр▒Нр░▓р▒Б р░╕р░░р░┐р░кр▒Лр░▓р░▓р▒Зр░жр▒Б',
        'password_too_short': 'р░кр░╛р░╕р▒НтАМр░╡р░░р▒Нр░бр▒Н р░Хр░ир▒Ар░╕р░В 6 р░Ер░Хр▒Нр░╖р░░р░╛р░▓р▒Б р░Йр░Вр░бр░╛р░▓р░┐',
        'username_required': 'р░╡р░┐р░ир░┐р░пр▒Лр░Чр░жр░╛р░░р▒Б р░кр▒Зр░░р▒Б р░ор░░р░┐р░пр▒Б р░кр░╛р░╕р▒НтАМр░╡р░░р▒Нр░бр▒Н р░Ер░╡р░╕р░░р░В',
        'registration_successful': 'р░░р░┐р░Ьр░┐р░╕р▒Нр░Яр▒Нр░░р▒Зр░╖р░ир▒Н р░╡р░┐р░Ьр░пр░╡р░Вр░др░В! р░жр░пр░Ър▒Зр░╕р░┐ р░▓р░╛р░Чр░┐р░ир▒Н р░Ър▒Зр░пр░Вр░бр░┐.',
        'username_exists': 'р░╡р░┐р░ир░┐р░пр▒Лр░Чр░жр░╛р░░р▒Б р░кр▒Зр░░р▒Б р░Зр░кр▒Нр░кр░Яр░┐р░Хр▒З р░Йр░Вр░жр░┐',
        'email_exists': 'р░Зр░ор▒Жр░пр░┐р░▓р▒Н р░Зр░кр▒Нр░кр░Яр░┐р░Хр▒З р░Йр░Вр░жр░┐',
        # Main form translations
        'app_main_title': 'ЁЯМ┐ р░кр▒Нр░▓р░╛р░Вр░Яр▒НтАМр░╕р▒Нр░кр▒Ар░Хр▒Н тАУ р░╕р░╛р░Вр░кр▒Нр░░р░жр░╛р░п р░ор▒Кр░Хр▒Нр░Хр░▓ р░Ьр▒Нр░Юр░╛р░ир░╛р░ир▒Нр░ир░┐ р░нр░жр▒Нр░░р░кр░░р░Ър░бр░Вр░▓р▒Л р░ор░╛р░Хр▒Б р░╕р░╣р░╛р░пр░кр░бр░Вр░бр░┐',
        'app_description': 'р░Ър░╛р░▓р░╛ р░ор░Вр░жр░┐ р░кр▒Жр░жр▒Нр░жр░▓р▒Б, р░░р▒Ир░др▒Бр░▓р▒Б р░ор░░р░┐р░пр▒Б р░╡р▒Ир░жр▒Нр░пр▒Бр░▓р░Хр▒Б р░╕р▒Нр░ер░╛р░ир░┐р░Х р░ор▒Кр░Хр▒Нр░Хр░▓ р░Чр▒Бр░░р░┐р░Вр░Ър░┐ р░▓р▒Лр░др▒Ир░и р░Ьр▒Нр░Юр░╛р░ир░В р░Йр░Вр░жр░┐ тАФ р░╡р▒Ир░жр▒Нр░пр░В, р░Жр░Ър░╛р░░р░╛р░▓р▒Б р░ор░░р░┐р░пр▒Б р░жр▒Ир░ир░Вр░жр░┐р░и р░Ьр▒Ар░╡р░┐р░др░Вр░▓р▒Л р░Йр░кр░пр▒Лр░Чр░┐р░Вр░Ър░мр░бр▒Бр░др▒Бр░Вр░жр░┐. р░И р░пр░╛р░кр▒Н р░Ж р░Ьр▒Нр░Юр░╛р░ир░╛р░ир▒Нр░ир░┐ р░╕р▒Зр░Хр░░р░┐р░Вр░Ър░┐, р░нр░жр▒Нр░░р░кр░░р░Ър░┐ р░ор░░р░┐р░пр▒Б р░кр░Вр░Ър▒Бр░Хр▒Лр░╡р░бр░Вр░▓р▒Л р░╕р░╣р░╛р░пр░кр░бр▒Бр░др▒Бр░Вр░жр░┐.',
        'step1_header': 'ЁЯУе р░жр░╢ 1: р░ор▒Кр░Хр▒Нр░Х р░пр▒Кр░Хр▒Нр░Х р░Ър░┐р░др▒Нр░░р░╛р░ир▒Нр░ир░┐ р░Ер░кр▒НтАМр░▓р▒Лр░бр▒Н р░Ър▒Зр░пр░Вр░бр░┐ р░▓р▒Зр░жр░╛ р░Чр▒Бр░░р▒Нр░др░┐р░Вр░Ър░Вр░бр░┐',
        'upload_photo': 'ЁЯУ╕ р░ор▒Кр░Хр▒Нр░Х р░пр▒Кр░Хр▒Нр░Х р░Ър░┐р░др▒Нр░░р░╛р░ир▒Нр░ир░┐ р░Ер░кр▒НтАМр░▓р▒Лр░бр▒Н р░Ър▒Зр░пр░Вр░бр░┐ (р░Жр░Хр▒Б, р░кр▒Бр░╡р▒Нр░╡р▒Б, р░мр▒Жр░░р░бр▒Б, р░ор▒Кр░жр░▓р▒Ир░ир░╡р░┐)',
        'plant_name_input': 'тЬНя╕П р░ор▒Кр░Хр▒Нр░Х р░кр▒Зр░░р▒Бр░ир▒Б р░ир░ор▒Лр░жр▒Б р░Ър▒Зр░пр░Вр░бр░┐ (р░П р░нр░╛р░╖р░▓р▒Л р░Ер░пр░┐р░ир░╛)',
        'entry_title_input': 'ЁЯУЭ р░кр▒Нр░░р░╡р▒Зр░╢ р░╢р▒Ар░░р▒Нр░╖р░┐р░Х (р░Рр░Ър▒Нр░Ыр░┐р░Хр░В)',
        'step2_header': 'ЁЯз╛ р░жр░╢ 2: р░ор▒А р░Ьр▒Нр░Юр░╛р░ир░╛р░ир▒Нр░ир░┐ р░кр░Вр░Ър▒Бр░Хр▒Лр░Вр░бр░┐',
        'local_names_input': '1я╕ПтГг р░ор▒Кр░Хр▒Нр░Х р░пр▒Кр░Хр▒Нр░Х р░╕р▒Нр░ер░╛р░ир░┐р░Х р░кр▒Зр░░р▒Нр░▓р▒Б',
        'scientific_name_input': '2я╕ПтГг р░╢р░╛р░╕р▒Нр░др▒Нр░░р▒Ар░п / р░╡р▒Гр░Хр▒Нр░╖р░╢р░╛р░╕р▒Нр░др▒Нр░░ р░кр▒Зр░░р▒Б (р░Рр░Ър▒Нр░Ыр░┐р░Хр░В)',
        'category_select': '3я╕ПтГг р░Йр░кр░пр▒Лр░Ч р░╡р░░р▒Нр░Чр░В',
        'usage_desc_input': '4я╕ПтГг р░ор▒Кр░Хр▒Нр░Х р░пр▒Кр░Хр▒Нр░Х р░Йр░кр░пр▒Лр░Чр░╛р░ир▒Нр░ир░┐ р░╡р░┐р░╡р░░р░┐р░Вр░Ър░Вр░бр░┐',
        'prep_method_input': '5я╕ПтГг р░др░пр░╛р░░р▒А р░▓р▒Зр░жр░╛ р░Ер░кр▒Нр░▓р░┐р░Хр▒Зр░╖р░ир▒Н р░кр▒Нр░░р░Хр▒Нр░░р░┐р░пр░ир▒Б р░╡р░┐р░╡р░░р░┐р░Вр░Ър░Вр░бр░┐',
        'community_input': '6я╕ПтГг р░ор▒А р░кр▒Нр░░р░╛р░Вр░др░Вр░▓р▒Л р░И р░ор▒Кр░Хр▒Нр░Хр░ир▒Б р░Ор░╡р░░р▒Б р░Йр░кр░пр▒Лр░Чр░┐р░╕р▒Нр░др░╛р░░р▒Б?',
        'tags_input': 'ЁЯФЦ р░Яр▒Нр░пр░╛р░Чр▒НтАМр░▓р▒Б р░▓р▒Зр░жр░╛ р░Хр▒Ар░╡р░░р▒Нр░бр▒НтАМр░▓р▒Б (р░Рр░Ър▒Нр░Ыр░┐р░Хр░В)',
        'step3_header': 'ЁЯМН р░жр░╢ 3: р░╕р▒Нр░ер░╛р░ир░В р░ор░░р░┐р░пр▒Б р░нр░╛р░╖',
        'location_input': '7я╕ПтГг р░И р░ор▒Кр░Хр▒Нр░Х р░Ор░Хр▒Нр░Хр░б р░жр▒Кр░░р▒Бр░Хр▒Бр░др▒Бр░Вр░жр░┐ р░▓р▒Зр░жр░╛ р░Йр░кр░пр▒Лр░Чр░┐р░Вр░Ър░мр░бр▒Бр░др▒Бр░Вр░жр░┐?',
        'language_input': '8я╕ПтГг р░ор▒А р░нр░╛р░╖ р░▓р▒Зр░жр░╛ р░ор░╛р░Вр░бр░▓р░┐р░Хр░В',
        'step4_header': 'ЁЯОд р░жр░╢ 4: р░╡р░╛р░пр░┐р░╕р▒Н р░ор░░р░┐р░пр▒Б р░Яр▒Жр░Хр▒Нр░╕р▒Нр░Яр▒Н р░Ер░жр░ир░кр▒Б',
        'voice_upload': '9я╕ПтГг р░╡р░╛р░пр░┐р░╕р▒Н р░░р░┐р░Хр░╛р░░р▒Нр░бр░┐р░Вр░Чр▒Н р░Ер░кр▒НтАМр░▓р▒Лр░бр▒Н р░Ър▒Зр░пр░Вр░бр░┐',
        'notes_upload': 'ЁЯФа 10я╕ПтГг р░Ър▒Зр░др░┐р░др▒Л р░╡р▒Нр░░р░╛р░╕р░┐р░и р░▓р▒Зр░жр░╛ р░ор▒Бр░жр▒Нр░░р░┐р░Вр░Ър░┐р░и р░Чр░ор░ир░┐р░Хр░▓р░ир▒Б р░Ер░кр▒НтАМр░▓р▒Лр░бр▒Н р░Ър▒Зр░пр░Вр░бр░┐',
        'step5_header': 'ЁЯСд р░жр░╢ 5: р░ор▒А р░Чр▒Бр░░р░┐р░Вр░Ър░┐',
        'age_group_select': '1я╕ПтГг1я╕ПтГг р░ор▒А р░╡р░пр▒Л р░╡р░░р▒Нр░Чр░В',
        'submit_button': 'ЁЯУд р░ор▒А р░╕р░╣р░Хр░╛р░░р░╛р░ир▒Нр░ир░┐ р░╕р░ор░░р▒Нр░кр░┐р░Вр░Ър░Вр░бр░┐'
    },
    'родрооро┐ро┤рпН': {
        'app_title': 'ЁЯМ┐ рокро┐ро│ро╛рогрпНроЯрпНро╕рпНрокрпАроХрпН тАУ рокро╛ро░роорпНрокро░ро┐роп родро╛ро╡ро░ роЕро▒ро┐ро╡рпИрокрпН рокро╛родрпБроХро╛роХрпНроХро╡рпБроорпН',
        'select_language': 'роорпКро┤ро┐ропрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН / Select Language / рднрд╛рд╖рд╛ рдЪреБрдиреЗрдВ',
        'login': 'роЙро│рпНроирпБро┤рпИро╡рпБ',
        'register': 'рокродро┐ро╡рпБ',
        'login_header': 'ЁЯФС рокро┐ро│ро╛рогрпНроЯрпНро╕рпНрокрпАроХрпНроХро┐ро▓рпН роЙро│рпНроирпБро┤рпИропро╡рпБроорпН',
        'register_header': 'ЁЯУЭ роХрогроХрпНроХрпИ роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН',
        'username': 'рокропройро░рпН рокрпЖропро░рпН',
        'password': 'роХроЯро╡рпБроЪрпНроЪрпКро▓рпН',
        'confirm_password': 'роХроЯро╡рпБроЪрпНроЪрпКро▓рпНро▓рпИ роЙро▒рпБродро┐рокрпНрокроЯрпБродрпНродро╡рпБроорпН',
        'full_name': 'роорпБро┤рпБ рокрпЖропро░рпН (ро╡ро┐ро░рпБрокрпНрокрооро╛ройродрпБ)',
        'email': 'рооро┐ройрпНройроЮрпНроЪро▓рпН (ро╡ро┐ро░рпБрокрпНрокрооро╛ройродрпБ)',
        'role': 'рокроЩрпНроХрпБ (роО.роХро╛: ро╡ро┐ро╡роЪро╛ропро┐, рооро░рпБродрпНродрпБро╡ро░рпН, роЖро░ро╛ропрпНроЪрпНроЪро┐ропро╛ро│ро░рпН)',
        'community': 'роЪроорпБродро╛ропроорпН роЕро▓рпНро▓родрпБ роЕроорпИрокрпНрокрпБ',
        'login_button': 'ЁЯФУ роЙро│рпНроирпБро┤рпИро╡рпБ',
        'register_button': 'тЬЕ рокродро┐ро╡рпБ',
        'logout_button': 'ЁЯЪк ро╡рпЖро│ро┐ропрпЗро▒рпБ',
        'welcome': 'ро╡ро░ро╡рпЗро▒рпНроХро┐ро▒рпЛроорпН',
        'navigation': 'ро╡ро┤ро┐роЪрпЖро▓рпБродрпНродро▓рпН',
        'add_entry': 'ЁЯУЭ рокрпБродро┐роп рокродро┐ро╡рпБ роЪрпЗро░рпНроХрпНроХро╡рпБроорпН',
        'view_submissions': 'ЁЯУЪ роЪрооро░рпНрокрпНрокрогроЩрпНроХро│рпИрокрпН рокро╛ро░рпНроХрпНроХро╡рпБроорпН',
        'my_profile': 'ЁЯСд роОройродрпБ роЪрпБропро╡ро┐ро╡ро░роорпН',
        'invalid_credentials': 'родро╡ро▒ро╛рой рокропройро░рпН рокрпЖропро░рпН роЕро▓рпНро▓родрпБ роХроЯро╡рпБроЪрпНроЪрпКро▓рпН',
        'passwords_not_match': 'роХроЯро╡рпБроЪрпНроЪрпКро▒рпНроХро│рпН рокрпКро░рпБроирпНродро╡ро┐ро▓рпНро▓рпИ',
        'password_too_short': 'роХроЯро╡рпБроЪрпНроЪрпКро▓рпН роХрпБро▒рпИроирпНродрокроЯрпНроЪроорпН 6 роОро┤рпБродрпНродрпБроХро│рпН роЗро░рпБроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН',
        'username_required': 'рокропройро░рпН рокрпЖропро░рпН рооро▒рпНро▒рпБроорпН роХроЯро╡рпБроЪрпНроЪрпКро▓рпН родрпЗро╡рпИ',
        'registration_successful': 'рокродро┐ро╡рпБ ро╡рпЖро▒рпНро▒ро┐роХро░рооро╛роХ! родропро╡рпБроЪрпЖропрпНродрпБ роЙро│рпНроирпБро┤рпИропро╡рпБроорпН.',
        'username_exists': 'рокропройро░рпН рокрпЖропро░рпН роПро▒рпНроХройро╡рпЗ роЙро│рпНро│родрпБ',
        'email_exists': 'рооро┐ройрпНройроЮрпНроЪро▓рпН роПро▒рпНроХройро╡рпЗ роЙро│рпНро│родрпБ',
        # Main form translations
        'app_main_title': 'ЁЯМ┐ рокро┐ро│ро╛рогрпНроЯрпНро╕рпНрокрпАроХрпН тАУ рокро╛ро░роорпНрокро░ро┐роп родро╛ро╡ро░ роЕро▒ро┐ро╡рпИрокрпН рокро╛родрпБроХро╛роХрпНроХ роОроЩрпНроХро│рпБроХрпНроХрпБ роЙродро╡рпБроЩрпНроХро│рпН',
        'app_description': 'рокро▓ рокрпЖро░ро┐ропро╡ро░рпНроХро│рпН, ро╡ро┐ро╡роЪро╛ропро┐роХро│рпН рооро▒рпНро▒рпБроорпН рооро░рпБродрпНродрпБро╡ро░рпНроХро│рпН роЙро│рпНро│рпВро░рпН родро╛ро╡ро░роЩрпНроХро│рпН рокро▒рпНро▒ро┐роп роЖро┤рооро╛рой роЕро▒ро┐ро╡рпИроХрпН роХрпКрогрпНроЯрпБро│рпНро│ройро░рпН тАФ рооро░рпБроирпНродрпБроХро│рпН, роЪроЯроЩрпНроХрпБроХро│рпН рооро▒рпНро▒рпБроорпН роЕройрпНро▒ро╛роЯ ро╡ро╛ро┤рпНроХрпНроХрпИропро┐ро▓рпН рокропройрпНрокроЯрпБродрпНродрокрпНрокроЯрпБроХро┐ройрпНро▒рой. роЗроирпНрод рокропройрпНрокро╛роЯрпБ роЕроирпНрод роЕро▒ро┐ро╡рпИ роЪрпЗроХро░ро┐родрпНродрпБ, рокро╛родрпБроХро╛родрпНродрпБ рооро▒рпНро▒рпБроорпН рокроХро┐ро░рпНроирпНродрпБроХрпКро│рпНро│ роЙродро╡рпБроХро┐ро▒родрпБ.',
        'step1_header': 'ЁЯУе рокроЯро┐ 1: родро╛ро╡ро░родрпНродро┐ройрпН рокроЯродрпНродрпИ рокродро┐ро╡рпЗро▒рпНро▒ро╡рпБроорпН роЕро▓рпНро▓родрпБ роЕроЯрпИропро╛ро│роорпН роХро╛рогро╡рпБроорпН',
        'upload_photo': 'ЁЯУ╕ родро╛ро╡ро░родрпНродро┐ройрпН рокроЯродрпНродрпИ рокродро┐ро╡рпЗро▒рпНро▒ро╡рпБроорпН (роЗро▓рпИ, рооро▓ро░рпН, рокроЯрпНроЯрпИ, рокрпЛройрпНро▒ро╡рпИ)',
        'plant_name_input': 'тЬНя╕П родро╛ро╡ро░родрпНродро┐ройрпН рокрпЖропро░рпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН (роОроирпНрод роорпКро┤ро┐ропро┐ро▓рпБроорпН)',
        'entry_title_input': 'ЁЯУЭ рокродро┐ро╡рпБ родро▓рпИрокрпНрокрпБ (ро╡ро┐ро░рпБрокрпНрокрооро╛ройродрпБ)',
        'step2_header': 'ЁЯз╛ рокроЯро┐ 2: роЙроЩрпНроХро│рпН роЕро▒ро┐ро╡рпИрокрпН рокроХро┐ро░рпБроЩрпНроХро│рпН',
        'local_names_input': '1я╕ПтГг родро╛ро╡ро░родрпНродро┐ройрпН роЙро│рпНро│рпВро░рпН рокрпЖропро░рпНроХро│рпН',
        'scientific_name_input': '2я╕ПтГг роЕро▒ро┐ро╡ро┐ропро▓рпН / родро╛ро╡ро░ро╡ро┐ропро▓рпН рокрпЖропро░рпН (ро╡ро┐ро░рпБрокрпНрокрооро╛ройродрпБ)',
        'category_select': '3я╕ПтГг рокропройрпНрокро╛роЯрпНроЯро┐ройрпН ро╡роХрпИ',
        'usage_desc_input': '4я╕ПтГг родро╛ро╡ро░родрпНродро┐ройрпН рокропройрпНрокро╛роЯрпНроЯрпИ ро╡ро┐ро╡ро░ро┐роХрпНроХро╡рпБроорпН',
        'prep_method_input': '5я╕ПтГг родропро╛ро░ро┐рокрпНрокрпБ роЕро▓рпНро▓родрпБ рокропройрпНрокро╛роЯрпНроЯрпБ роЪрпЖропро▓рпНроорпБро▒рпИропрпИ ро╡ро┐ро│роХрпНроХро╡рпБроорпН',
        'community_input': '6я╕ПтГг роЙроЩрпНроХро│рпН рокроХрпБродро┐ропро┐ро▓рпН роЗроирпНрод родро╛ро╡ро░родрпНродрпИ ропро╛ро░рпН рокропройрпНрокроЯрпБродрпНродрпБроХро┐ро▒ро╛ро░рпНроХро│рпН?',
        'tags_input': 'ЁЯФЦ роХрпБро▒ро┐роЪрпНроЪрпКро▒рпНроХро│рпН роЕро▓рпНро▓родрпБ роорпБроХрпНроХро┐роп ро╡ро╛ро░рпНродрпНродрпИроХро│рпН (ро╡ро┐ро░рпБрокрпНрокрооро╛ройродрпБ)',
        'step3_header': 'ЁЯМН рокроЯро┐ 3: роЗроЯроорпН рооро▒рпНро▒рпБроорпН роорпКро┤ро┐',
        'location_input': '7я╕ПтГг роЗроирпНрод родро╛ро╡ро░роорпН роОроЩрпНроХрпЗ роХро╛рогрокрпНрокроЯрпБроХро┐ро▒родрпБ роЕро▓рпНро▓родрпБ рокропройрпНрокроЯрпБродрпНродрокрпНрокроЯрпБроХро┐ро▒родрпБ?',
        'language_input': '8я╕ПтГг роЙроЩрпНроХро│рпН роорпКро┤ро┐ роЕро▓рпНро▓родрпБ рокрпЗроЪрпНроЪрпБро╡ро┤роХрпНроХрпБ',
        'step4_header': 'ЁЯОд рокроЯро┐ 4: роХрпБро░ро▓рпН рооро▒рпНро▒рпБроорпН роЙро░рпИ роХрпВроЯрпБродро▓рпН',
        'voice_upload': '9я╕ПтГг роХрпБро░ро▓рпН рокродро┐ро╡рпИ рокродро┐ро╡рпЗро▒рпНро▒ро╡рпБроорпН',
        'notes_upload': 'ЁЯФа 10я╕ПтГг роХрпИропро╛ро▓рпН роОро┤рпБродрокрпНрокроЯрпНроЯ роЕро▓рпНро▓родрпБ роЕроЪрпНроЪро┐роЯрокрпНрокроЯрпНроЯ роХрпБро▒ро┐рокрпНрокрпБроХро│рпИ рокродро┐ро╡рпЗро▒рпНро▒ро╡рпБроорпН',
        'step5_header': 'ЁЯСд рокроЯро┐ 5: роЙроЩрпНроХро│рпИрокрпН рокро▒рпНро▒ро┐',
        'age_group_select': '1я╕ПтГг1я╕ПтГг роЙроЩрпНроХро│рпН ро╡ропродрпБ роХрпБро┤рпБ',
        'submit_button': 'ЁЯУд роЙроЩрпНроХро│рпН рокроЩрпНроХро│ро┐рокрпНрокрпИ роЪрооро░рпНрокрпНрокро┐роХрпНроХро╡рпБроорпН'
    },
    'р▓Хр▓ир│Нр▓ир▓б': {
        'app_title': 'ЁЯМ┐ р▓кр│Нр▓▓р▓╛р▓Вр▓Яр│НтАМр▓╕р│Нр▓кр│Ар▓Хр│Н тАУ р▓╕р▓╛р▓Вр▓кр│Нр▓░р▓жр▓╛р▓пр▓┐р▓Х р▓╕р▓╕р│Нр▓п р▓Ьр│Нр▓Юр▓╛р▓ир▓╡р▓ир│Нр▓ир│Б р▓╕р▓Вр▓░р▓Хр│Нр▓╖р▓┐р▓╕р▓┐',
        'select_language': 'р▓нр▓╛р▓╖р│Жр▓пр▓ир│Нр▓ир│Б р▓Жр▓пр│Нр▓Хр│Ж р▓ор▓╛р▓бр▓┐ / Select Language / рднрд╛рд╖рд╛ рдЪреБрдиреЗрдВ',
        'login': 'р▓▓р▓╛р▓Чр▓┐р▓ир│Н',
        'register': 'р▓ир│Лр▓Вр▓жр▓гр▓┐',
        'login_header': 'ЁЯФС р▓кр│Нр▓▓р▓╛р▓Вр▓Яр│НтАМр▓╕р│Нр▓кр│Ар▓Хр│НтАМр▓Чр│Ж р▓▓р▓╛р▓Чр▓┐р▓ир│Н р▓ор▓╛р▓бр▓┐',
        'register_header': 'ЁЯУЭ р▓Цр▓╛р▓др│Жр▓пр▓ир│Нр▓ир│Б р▓░р▓Ър▓┐р▓╕р▓┐',
        'username': 'р▓мр▓│р▓Хр│Жр▓жр▓╛р▓░ р▓╣р│Жр▓╕р▓░р│Б',
        'password': 'р▓кр▓╛р▓╕р│НтАМр▓╡р▓░р│Нр▓бр│Н',
        'confirm_password': 'р▓кр▓╛р▓╕р│НтАМр▓╡р▓░р│Нр▓бр│Н р▓Цр▓Ър▓┐р▓др▓кр▓бр▓┐р▓╕р▓┐',
        'full_name': 'р▓кр│Вр▓░р│Нр▓г р▓╣р│Жр▓╕р▓░р│Б (р▓Рр▓Ър│Нр▓Ыр▓┐р▓Х)',
        'email': 'р▓Зр▓ор│Зр▓▓р│Н (р▓Рр▓Ър│Нр▓Ыр▓┐р▓Х)',
        'role': 'р▓кр▓╛р▓др│Нр▓░ (р▓Йр▓жр▓╛: р▓░р│Ир▓д, р▓╡р│Ир▓жр│Нр▓п, р▓╕р▓Вр▓╢р│Лр▓зр▓Х)',
        'community': 'р▓╕р▓ор│Бр▓жр▓╛р▓п р▓Ер▓ер▓╡р▓╛ р▓╕р▓Вр▓╕р│Нр▓ер│Ж',
        'login_button': 'ЁЯФУ р▓▓р▓╛р▓Чр▓┐р▓ир│Н',
        'register_button': 'тЬЕ р▓ир│Лр▓Вр▓жр▓гр▓┐',
        'logout_button': 'ЁЯЪк р▓▓р▓╛р▓Чр│НтАМр▓Фр▓Яр│Н',
        'welcome': 'р▓╕р│Нр▓╡р▓╛р▓Чр▓д',
        'navigation': 'р▓ир│Нр▓пр▓╛р▓╡р▓┐р▓Чр│Зр▓╢р▓ир│Н',
        'add_entry': 'ЁЯУЭ р▓╣р│Кр▓╕ р▓кр│Нр▓░р▓╡р│Зр▓╢ р▓╕р│Зр▓░р▓┐р▓╕р▓┐',
        'view_submissions': 'ЁЯУЪ р▓╕р▓▓р│Нр▓▓р▓┐р▓Хр│Жр▓Чр▓│р▓ир│Нр▓ир│Б р▓╡р│Ар▓Хр│Нр▓╖р▓┐р▓╕р▓┐',
        'my_profile': 'ЁЯСд р▓ир▓ир│Нр▓и р▓кр│Нр▓░р│Кр▓лр│Ир▓▓р│Н',
        'invalid_credentials': 'р▓др▓кр│Нр▓кр▓╛р▓ж р▓мр▓│р▓Хр│Жр▓жр▓╛р▓░ р▓╣р│Жр▓╕р▓░р│Б р▓Ер▓ер▓╡р▓╛ р▓кр▓╛р▓╕р│НтАМр▓╡р▓░р│Нр▓бр│Н',
        'passwords_not_match': 'р▓кр▓╛р▓╕р│НтАМр▓╡р▓░р│Нр▓бр│НтАМр▓Чр▓│р│Б р▓╣р│Кр▓Вр▓жр▓┐р▓Хр│Жр▓пр▓╛р▓Чр│Бр▓др│Нр▓др▓┐р▓▓р│Нр▓▓',
        'password_too_short': 'р▓кр▓╛р▓╕р│НтАМр▓╡р▓░р│Нр▓бр│Н р▓Хр▓ир▓┐р▓╖р│Нр▓а 6 р▓Ер▓Хр│Нр▓╖р▓░р▓Чр▓│р▓╛р▓Чр▓┐р▓░р▓мр│Зр▓Хр│Б',
        'username_required': 'р▓мр▓│р▓Хр│Жр▓жр▓╛р▓░ р▓╣р│Жр▓╕р▓░р│Б р▓ор▓др│Нр▓др│Б р▓кр▓╛р▓╕р│НтАМр▓╡р▓░р│Нр▓бр│Н р▓Ер▓Чр▓др│Нр▓п',
        'registration_successful': 'р▓ир│Лр▓Вр▓жр▓гр▓┐ р▓пр▓╢р▓╕р│Нр▓╡р▓┐! р▓жр▓пр▓╡р▓┐р▓Яр│Нр▓Яр│Б р▓▓р▓╛р▓Чр▓┐р▓ир│Н р▓ор▓╛р▓бр▓┐.',
        'username_exists': 'р▓мр▓│р▓Хр│Жр▓жр▓╛р▓░ р▓╣р│Жр▓╕р▓░р│Б р▓Ир▓Чр▓╛р▓Чр▓▓р│З р▓Ер▓╕р│Нр▓др▓┐р▓др│Нр▓╡р▓жр▓▓р│Нр▓▓р▓┐р▓жр│Ж',
        'email_exists': 'р▓Зр▓ор│Зр▓▓р│Н р▓Ир▓Чр▓╛р▓Чр▓▓р│З р▓Ер▓╕р│Нр▓др▓┐р▓др│Нр▓╡р▓жр▓▓р│Нр▓▓р▓┐р▓жр│Ж',
        # Main form translations
        'app_main_title': 'ЁЯМ┐ р▓кр│Нр▓▓р▓╛р▓Вр▓Яр│НтАМр▓╕р│Нр▓кр│Ар▓Хр│Н тАУ р▓╕р▓╛р▓Вр▓кр│Нр▓░р▓жр▓╛р▓пр▓┐р▓Х р▓╕р▓╕р│Нр▓п р▓Ьр│Нр▓Юр▓╛р▓ир▓╡р▓ир│Нр▓ир│Б р▓╕р▓Вр▓░р▓Хр│Нр▓╖р▓┐р▓╕р▓▓р│Б р▓ир▓ор▓Чр│Ж р▓╕р▓╣р▓╛р▓п р▓ор▓╛р▓бр▓┐',
        'app_description': 'р▓Ер▓ир│Зр▓Х р▓╣р▓┐р▓░р▓┐р▓пр▓░р│Б, р▓░р│Ир▓др▓░р│Б р▓ор▓др│Нр▓др│Б р▓╡р│Ир▓жр│Нр▓пр▓░р│Б р▓╕р│Нр▓ер▓│р│Ар▓п р▓╕р▓╕р│Нр▓пр▓Чр▓│ р▓мр▓Чр│Нр▓Чр│Ж р▓Жр▓│р▓╡р▓╛р▓ж р▓Ьр│Нр▓Юр▓╛р▓ир▓╡р▓ир│Нр▓ир│Б р▓╣р│Кр▓Вр▓жр▓┐р▓жр│Нр▓жр▓╛р▓░р│Ж тАФ р▓Фр▓╖р▓зр▓Чр▓│р│Б, р▓Жр▓Ър▓╛р▓░р▓Чр▓│р│Б р▓ор▓др│Нр▓др│Б р▓жр│Ир▓ир▓Вр▓жр▓┐р▓и р▓Ьр│Ар▓╡р▓ир▓жр▓▓р│Нр▓▓р▓┐ р▓мр▓│р▓╕р▓▓р▓╛р▓Чр│Бр▓др│Нр▓др▓жр│Ж. р▓И р▓Ер▓кр│Нр▓▓р▓┐р▓Хр│Зр▓╢р▓ир│Н р▓Ж р▓Ьр│Нр▓Юр▓╛р▓ир▓╡р▓ир│Нр▓ир│Б р▓╕р▓Вр▓Чр│Нр▓░р▓╣р▓┐р▓╕р▓▓р│Б, р▓╕р▓Вр▓░р▓Хр│Нр▓╖р▓┐р▓╕р▓▓р│Б р▓ор▓др│Нр▓др│Б р▓╣р▓Вр▓Ър▓┐р▓Хр│Кр▓│р│Нр▓│р▓▓р│Б р▓╕р▓╣р▓╛р▓п р▓ор▓╛р▓бр│Бр▓др│Нр▓др▓жр│Ж.',
        'step1_header': 'ЁЯУе р▓╣р▓Вр▓д 1: р▓╕р▓╕р│Нр▓пр▓ж р▓Ър▓┐р▓др│Нр▓░р▓╡р▓ир│Нр▓ир│Б р▓Ер▓кр│НтАМр▓▓р│Лр▓бр│Н р▓ор▓╛р▓бр▓┐ р▓Ер▓ер▓╡р▓╛ р▓Чр│Бр▓░р│Бр▓др▓┐р▓╕р▓┐',
        'upload_photo': 'ЁЯУ╕ р▓╕р▓╕р│Нр▓пр▓ж р▓Ър▓┐р▓др│Нр▓░р▓╡р▓ир│Нр▓ир│Б р▓Ер▓кр│НтАМр▓▓р│Лр▓бр│Н р▓ор▓╛р▓бр▓┐ (р▓Ор▓▓р│Ж, р▓╣р│Вр▓╡р│Б, р▓др│Кр▓Чр▓Яр│Ж, р▓Зр▓др│Нр▓пр▓╛р▓жр▓┐)',
        'plant_name_input': 'тЬНя╕П р▓╕р▓╕р│Нр▓пр▓ж р▓╣р│Жр▓╕р▓░р▓ир│Нр▓ир│Б р▓ир▓ор│Вр▓жр▓┐р▓╕р▓┐ (р▓пр▓╛р▓╡р│Бр▓жр│З р▓нр▓╛р▓╖р│Жр▓пр▓▓р│Нр▓▓р▓┐)',
        'entry_title_input': 'ЁЯУЭ р▓кр│Нр▓░р▓╡р│Зр▓╢ р▓╢р│Ар▓░р│Нр▓╖р▓┐р▓Хр│Ж (р▓Рр▓Ър│Нр▓Ыр▓┐р▓Х)',
        'step2_header': 'ЁЯз╛ р▓╣р▓Вр▓д 2: р▓ир▓┐р▓ор│Нр▓о р▓Ьр│Нр▓Юр▓╛р▓ир▓╡р▓ир│Нр▓ир│Б р▓╣р▓Вр▓Ър▓┐р▓Хр│Кр▓│р│Нр▓│р▓┐',
        'local_names_input': '1я╕ПтГг р▓╕р▓╕р│Нр▓пр▓ж р▓╕р│Нр▓ер▓│р│Ар▓п р▓╣р│Жр▓╕р▓░р│Бр▓Чр▓│р│Б',
        'scientific_name_input': '2я╕ПтГг р▓╡р│Ир▓Ьр│Нр▓Юр▓╛р▓ир▓┐р▓Х / р▓╕р▓╕р│Нр▓пр▓╢р▓╛р▓╕р│Нр▓др│Нр▓░р│Ар▓п р▓╣р│Жр▓╕р▓░р│Б (р▓Рр▓Ър│Нр▓Ыр▓┐р▓Х)',
        'category_select': '3я╕ПтГг р▓мр▓│р▓Хр│Жр▓п р▓╡р▓░р│Нр▓Ч',
        'usage_desc_input': '4я╕ПтГг р▓╕р▓╕р│Нр▓пр▓ж р▓мр▓│р▓Хр│Жр▓пр▓ир│Нр▓ир│Б р▓╡р▓┐р▓╡р▓░р▓┐р▓╕р▓┐',
        'prep_method_input': '5я╕ПтГг р▓др▓пр▓╛р▓░р▓┐р▓Хр│Ж р▓Ер▓ер▓╡р▓╛ р▓Ер▓ир│Нр▓╡р▓п р▓кр│Нр▓░р▓Хр│Нр▓░р▓┐р▓пр│Жр▓пр▓ир│Нр▓ир│Б р▓╡р▓┐р▓╡р▓░р▓┐р▓╕р▓┐',
        'community_input': '6я╕ПтГг р▓ир▓┐р▓ор│Нр▓о р▓кр│Нр▓░р▓жр│Зр▓╢р▓жр▓▓р│Нр▓▓р▓┐ р▓И р▓╕р▓╕р│Нр▓пр▓╡р▓ир│Нр▓ир│Б р▓пр▓╛р▓░р│Б р▓мр▓│р▓╕р│Бр▓др│Нр▓др▓╛р▓░р│Ж?',
        'tags_input': 'ЁЯФЦ р▓Яр│Нр▓пр▓╛р▓Чр│НтАМр▓Чр▓│р│Б р▓Ер▓ер▓╡р▓╛ р▓Хр│Ар▓╡р▓░р│Нр▓бр│НтАМр▓Чр▓│р│Б (р▓Рр▓Ър│Нр▓Ыр▓┐р▓Х)',
        'step3_header': 'ЁЯМН р▓╣р▓Вр▓д 3: р▓╕р│Нр▓ер▓│ р▓ор▓др│Нр▓др│Б р▓нр▓╛р▓╖р│Ж',
        'location_input': '7я╕ПтГг р▓И р▓╕р▓╕р│Нр▓п р▓Ор▓▓р│Нр▓▓р▓┐ р▓Хр▓Вр▓бр│Бр▓мр▓░р│Бр▓др│Нр▓др▓жр│Ж р▓Ер▓ер▓╡р▓╛ р▓мр▓│р▓╕р▓▓р▓╛р▓Чр│Бр▓др│Нр▓др▓жр│Ж?',
        'language_input': '8я╕ПтГг р▓ир▓┐р▓ор│Нр▓о р▓нр▓╛р▓╖р│Ж р▓Ер▓ер▓╡р▓╛ р▓Йр▓кр▓нр▓╛р▓╖р│Ж',
        'step4_header': 'ЁЯОд р▓╣р▓Вр▓д 4: р▓зр│Нр▓╡р▓ир▓┐ р▓ор▓др│Нр▓др│Б р▓кр▓ар│Нр▓п р▓╣р│Жр▓Ър│Нр▓Ър│Бр▓╡р▓░р▓┐',
        'voice_upload': '9я╕ПтГг р▓зр│Нр▓╡р▓ир▓┐ р▓░р│Жр▓Хр▓╛р▓░р│Нр▓бр▓┐р▓Вр▓Чр│Н р▓Ер▓кр│НтАМр▓▓р│Лр▓бр│Н р▓ор▓╛р▓бр▓┐',
        'notes_upload': 'ЁЯФа 10я╕ПтГг р▓Хр│Ир▓пр▓┐р▓Вр▓ж р▓мр▓░р│Жр▓ж р▓Ер▓ер▓╡р▓╛ р▓ор│Бр▓жр│Нр▓░р▓┐р▓д р▓Яр▓┐р▓кр│Нр▓кр▓гр▓┐р▓Чр▓│р▓ир│Нр▓ир│Б р▓Ер▓кр│НтАМр▓▓р│Лр▓бр│Н р▓ор▓╛р▓бр▓┐',
        'step5_header': 'ЁЯСд р▓╣р▓Вр▓д 5: р▓ир▓┐р▓ор│Нр▓о р▓мр▓Чр│Нр▓Чр│Ж',
        'age_group_select': '1я╕ПтГг1я╕ПтГг р▓ир▓┐р▓ор│Нр▓о р▓╡р▓пр▓╕р│Нр▓╕р▓┐р▓и р▓Чр│Бр▓Вр▓кр│Б',
        'submit_button': 'ЁЯУд р▓ир▓┐р▓ор│Нр▓о р▓Хр│Кр▓бр│Бр▓Чр│Жр▓пр▓ир│Нр▓ир│Б р▓╕р▓▓р│Нр▓▓р▓┐р▓╕р▓┐'
    },
    'рдорд░рд╛рдареА': {
        'app_title': 'ЁЯМ┐ рдкреНрд▓рд╛рдВрдЯрд╕реНрдкреАрдХ тАУ рдкрд╛рд░рдВрдкрд╛рд░рд┐рдХ рд╡рдирд╕реНрдкрддреА рдЬреНрдЮрд╛рди рдЬрддрди рдХрд░рд╛',
        'select_language': 'рднрд╛рд╖рд╛ рдирд┐рд╡рдбрд╛ / Select Language / рднрд╛рд╖рд╛ рдЪреБрдиреЗрдВ',
        'login': 'рд▓реЙрдЧрд┐рди',
        'register': 'рдиреЛрдВрджрдгреА',
        'login_header': 'ЁЯФС рдкреНрд▓рд╛рдВрдЯрд╕реНрдкреАрдХрдордзреНрдпреЗ рд▓реЙрдЧрд┐рди рдХрд░рд╛',
        'register_header': 'ЁЯУЭ рдЦрд╛рддреЗ рддрдпрд╛рд░ рдХрд░рд╛',
        'username': 'рд╡рд╛рдкрд░рдХрд░реНрддрд╛ рдирд╛рд╡',
        'password': 'рдкрд╛рд╕рд╡рд░реНрдб',
        'confirm_password': 'рдкрд╛рд╕рд╡рд░реНрдбрдЪреА рдкреБрд╖реНрдЯреА рдХрд░рд╛',
        'full_name': 'рдкреВрд░реНрдг рдирд╛рд╡ (рдкрд░реНрдпрд╛рдпреА)',
        'email': 'рдИрдореЗрд▓ (рдкрд░реНрдпрд╛рдпреА)',
        'role': 'рднреВрдорд┐рдХрд╛ (рдЙрджрд╛: рд╢реЗрддрдХрд░реА, рд╡реИрджреНрдп, рд╕рдВрд╢реЛрдзрдХ)',
        'community': 'рд╕рдореБрджрд╛рдп рдХрд┐рдВрд╡рд╛ рд╕рдВрд╕реНрдерд╛',
        'login_button': 'ЁЯФУ рд▓реЙрдЧрд┐рди',
        'register_button': 'тЬЕ рдиреЛрдВрджрдгреА',
        'logout_button': 'ЁЯЪк рд▓реЙрдЧрдЖрдЙрдЯ',
        'welcome': 'рд╕реНрд╡рд╛рдЧрдд',
        'navigation': 'рдиреЗрд╡реНрд╣рд┐рдЧреЗрд╢рди',
        'add_entry': 'ЁЯУЭ рдирд╡реАрди рдПрдВрдЯреНрд░реА рдЬреЛрдбрд╛',
        'view_submissions': 'ЁЯУЪ рд╕рдмрдорд┐рд╢рди рдкрд╣рд╛',
        'my_profile': 'ЁЯСд рдорд╛рдЭреЗ рдкреНрд░реЛрдлрд╛рдЗрд▓',
        'invalid_credentials': 'рдЪреБрдХреАрдЪреЗ рд╡рд╛рдкрд░рдХрд░реНрддрд╛ рдирд╛рд╡ рдХрд┐рдВрд╡рд╛ рдкрд╛рд╕рд╡рд░реНрдб',
        'passwords_not_match': 'рдкрд╛рд╕рд╡рд░реНрдб рдЬреБрд│рдд рдирд╛рд╣реАрдд',
        'password_too_short': 'рдкрд╛рд╕рд╡рд░реНрдб рдХрд┐рдорд╛рди 6 рдЕрдХреНрд╖рд░рд╛рдВрдЪрд╛ рдЕрд╕рд╛рд╡рд╛',
        'username_required': 'рд╡рд╛рдкрд░рдХрд░реНрддрд╛ рдирд╛рд╡ рдЖрдгрд┐ рдкрд╛рд╕рд╡рд░реНрдб рдЖрд╡рд╢реНрдпрдХ',
        'registration_successful': 'рдиреЛрдВрджрдгреА рдпрд╢рд╕реНрд╡реА! рдХреГрдкрдпрд╛ рд▓реЙрдЧрд┐рди рдХрд░рд╛.',
        'username_exists': 'рд╡рд╛рдкрд░рдХрд░реНрддрд╛ рдирд╛рд╡ рдЖрдзреАрдЪ рдЕрд╕реНрддрд┐рддреНрд╡рд╛рдд рдЖрд╣реЗ',
        'email_exists': 'рдИрдореЗрд▓ рдЖрдзреАрдЪ рдЕрд╕реНрддрд┐рддреНрд╡рд╛рдд рдЖрд╣реЗ',
        # Main form translations
        'app_main_title': 'ЁЯМ┐ рдкреНрд▓рд╛рдВрдЯрд╕реНрдкреАрдХ тАУ рдкрд╛рд░рдВрдкрд╛рд░рд┐рдХ рд╡рдирд╕реНрдкрддреА рдЬреНрдЮрд╛рди рдЬрддрди рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдЖрдореНрд╣рд╛рд▓рд╛ рдорджрдд рдХрд░рд╛',
        'app_description': 'рдЕрдиреЗрдХ рд╡рдбреАрд▓, рд╢реЗрддрдХрд░реА рдЖрдгрд┐ рд╡реИрджреНрдп рдпрд╛рдВрдЪреНрдпрд╛рдХрдбреЗ рд╕реНрдерд╛рдирд┐рдХ рд╡рдирд╕реНрдкрддреАрдВрдмрджреНрджрд▓ рд╕рдЦреЛрд▓ рдЬреНрдЮрд╛рди рдЖрд╣реЗ тАФ рдФрд╖рдзреЗ, рд╡рд┐рдзреА рдЖрдгрд┐ рджреИрдирдВрджрд┐рди рдЬреАрд╡рдирд╛рдд рд╡рд╛рдкрд░рд▓реЗ рдЬрд╛рддреЗ. рд╣реЗ рдЕтАНреЕрдк рддреНрдпрд╛ рдЬреНрдЮрд╛рдирд╛рдЪреЗ рд╕рдВрдХрд▓рди, рд╕рдВрд░рдХреНрд╖рдг рдЖрдгрд┐ рд╕рд╛рдЭрд╛рдХрд░рдг рдХрд░рдгреНрдпрд╛рдд рдорджрдд рдХрд░рддреЗ.',
        'step1_header': 'ЁЯУе рдкрд╛рдпрд░реА 1: рд╡рдирд╕реНрдкрддреАрдЪреЗ рдЫрд╛рдпрд╛рдЪрд┐рддреНрд░ рдЕрдкрд▓реЛрдб рдХрд░рд╛ рдХрд┐рдВрд╡рд╛ рдУрд│рдЦрд╛',
        'upload_photo': 'ЁЯУ╕ рд╡рдирд╕реНрдкрддреАрдЪреЗ рдЫрд╛рдпрд╛рдЪрд┐рддреНрд░ рдЕрдкрд▓реЛрдб рдХрд░рд╛ (рдкрд╛рди, рдлреВрд▓, рд╕рд╛рд▓, рдЗрддреНрдпрд╛рджреА)',
        'plant_name_input': 'тЬНя╕П рд╡рдирд╕реНрдкрддреАрдЪреЗ рдирд╛рд╡ рдкреНрд░рд╡рд┐рд╖реНрдЯ рдХрд░рд╛ (рдХреЛрдгрддреНрдпрд╛рд╣реА рднрд╛рд╖реЗрдд)',
        'entry_title_input': 'ЁЯУЭ рдПрдВрдЯреНрд░реА рд╢реАрд░реНрд╖рдХ (рдкрд░реНрдпрд╛рдпреА)',
        'step2_header': 'ЁЯз╛ рдкрд╛рдпрд░реА 2: рддреБрдордЪреЗ рдЬреНрдЮрд╛рди рд╕рд╛рдорд╛рдпрд┐рдХ рдХрд░рд╛',
        'local_names_input': '1я╕ПтГг рд╡рдирд╕реНрдкрддреАрдЪреА рд╕реНрдерд╛рдирд┐рдХ рдирд╛рд╡реЗ',
        'scientific_name_input': '2я╕ПтГг рд╡реИрдЬреНрдЮрд╛рдирд┐рдХ / рд╡рдирд╕реНрдкрддрд┐рд╢рд╛рд╕реНрддреНрд░реАрдп рдирд╛рд╡ (рдкрд░реНрдпрд╛рдпреА)',
        'category_select': '3я╕ПтГг рд╡рд╛рдкрд░рд╛рдЪреА рд╢реНрд░реЗрдгреА',
        'usage_desc_input': '4я╕ПтГг рд╡рдирд╕реНрдкрддреАрдЪреНрдпрд╛ рд╡рд╛рдкрд░рд╛рдЪреЗ рд╡рд░реНрдгрди рдХрд░рд╛',
        'prep_method_input': '5я╕ПтГг рддрдпрд╛рд░реА рдХрд┐рдВрд╡рд╛ рд╡рд╛рдкрд░рд╛рдЪреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реНрдкрд╖реНрдЯ рдХрд░рд╛',
        'community_input': '6я╕ПтГг рддреБрдордЪреНрдпрд╛ рднрд╛рдЧрд╛рдд рд╣реА рд╡рдирд╕реНрдкрддреА рдХреЛрдг рд╡рд╛рдкрд░рддреЗ?',
        'tags_input': 'ЁЯФЦ рдЯреЕрдЧ рдХрд┐рдВрд╡рд╛ рдХреАрд╡рд░реНрдб (рдкрд░реНрдпрд╛рдпреА)',
        'step3_header': 'ЁЯМН рдкрд╛рдпрд░реА 3: рд╕реНрдерд╛рди рдЖрдгрд┐ рднрд╛рд╖рд╛',
        'location_input': '7я╕ПтГг рд╣реА рд╡рдирд╕реНрдкрддреА рдХреБрдареЗ рд╕рд╛рдкрдбрддреЗ рдХрд┐рдВрд╡рд╛ рд╡рд╛рдкрд░рд▓реА рдЬрд╛рддреЗ?',
        'language_input': '8я╕ПтГг рддреБрдордЪреА рднрд╛рд╖рд╛ рдХрд┐рдВрд╡рд╛ рдмреЛрд▓реА',
        'step4_header': 'ЁЯОд рдкрд╛рдпрд░реА 4: рдЖрд╡рд╛рдЬ рдЖрдгрд┐ рдордЬрдХреВрд░ рдЕрддрд┐рд░рд┐рдХреНрдд',
        'voice_upload': '9я╕ПтГг рдЖрд╡рд╛рдЬ рд░реЗрдХреЙрд░реНрдбрд┐рдВрдЧ рдЕрдкрд▓реЛрдб рдХрд░рд╛',
        'notes_upload': 'ЁЯФа 10я╕ПтГг рд╣рд╕реНрддрд▓рд┐рдЦрд┐рдд рдХрд┐рдВрд╡рд╛ рдореБрджреНрд░рд┐рдд рдиреЛрдЯреНрд╕ рдЕрдкрд▓реЛрдб рдХрд░рд╛',
        'step5_header': 'ЁЯСд рдкрд╛рдпрд░реА 5: рддреБрдордЪреНрдпрд╛рдмрджреНрджрд▓',
        'age_group_select': '1я╕ПтГг1я╕ПтГг рддреБрдордЪрд╛ рд╡рдпреЛрдЧрдЯ',
        'submit_button': 'ЁЯУд рддреБрдордЪреЗ рдпреЛрдЧрджрд╛рди рд╕рдмрдорд┐рдЯ рдХрд░рд╛'
    },
    'р┤ор┤▓р┤пр┤╛р┤│р┤В': {
        'app_title': 'ЁЯМ┐ р┤кр╡Нр┤▓р┤╛р┤ир╡Нр┤▒р╡НтАМр┤╕р╡Нр┤кр╡Ар┤Хр╡Нр┤Хр╡Н тАУ р┤кр┤░р┤ор╡Нр┤кр┤░р┤╛р┤Чр┤д р┤╕р┤╕р╡Нр┤п р┤Ер┤▒р┤┐р┤╡р╡Н р┤╕р┤Вр┤░р┤Хр╡Нр┤╖р┤┐р┤Хр╡Нр┤Хр╡Бр┤Х',
        'select_language': 'р┤нр┤╛р┤╖ р┤др┤┐р┤░р┤Юр╡Нр┤Юр╡Жр┤Яр╡Бр┤Хр╡Нр┤Хр╡Бр┤Х / Select Language / рднрд╛рд╖рд╛ рдЪреБрдиреЗрдВ',
        'login': 'р┤▓р╡Лр┤Чр┤┐р╡╗',
        'register': 'р┤░р┤Ьр┤┐р┤╕р╡Нр┤▒р╡Нр┤▒р╡╝',
        'login_header': 'ЁЯФС р┤кр╡Нр┤▓р┤╛р┤ир╡Нр┤▒р╡НтАМр┤╕р╡Нр┤кр╡Ар┤Хр╡Нр┤Хр┤┐р╡╜ р┤▓р╡Лр┤Чр┤┐р╡╗ р┤Ър╡Жр┤пр╡Нр┤пр╡Бр┤Х',
        'register_header': 'ЁЯУЭ р┤Ер┤Хр╡Нр┤Хр╡Чр┤гр╡Нр┤Яр╡Н р┤╕р╡Гр┤╖р╡Нр┤Яр┤┐р┤Хр╡Нр┤Хр╡Бр┤Х',
        'username': 'р┤Йр┤кр┤пр╡Лр┤Хр╡Нр┤др╡Гр┤ир┤╛р┤ор┤В',
        'password': 'р┤кр┤╛р┤╕р╡НтАМр┤╡р╡Зр┤бр╡Н',
        'confirm_password': 'р┤кр┤╛р┤╕р╡НтАМр┤╡р╡Зр┤бр╡Н р┤╕р╡Нр┤ер┤┐р┤░р╡Ар┤Хр┤░р┤┐р┤Хр╡Нр┤Хр╡Бр┤Х',
        'full_name': 'р┤кр╡Вр╡╝р┤гр╡Нр┤г р┤ир┤╛р┤ор┤В (р┤Ур┤кр╡Нр┤╖р┤гр╡╜)',
        'email': 'р┤Зр┤ор╡Жр┤пр┤┐р╡╜ (р┤Ур┤кр╡Нр┤╖р┤гр╡╜)',
        'role': 'р┤кр┤Щр╡Нр┤Хр╡Н (р┤Йр┤жр┤╛: р┤Хр╡╝р┤╖р┤Хр╡╗, р┤╡р╡Ир┤жр╡Нр┤пр╡╗, р┤Чр┤╡р╡Зр┤╖р┤Хр╡╗)',
        'community': 'р┤Хр┤ор╡Нр┤ор╡Нр┤пр╡Вр┤гр┤┐р┤▒р╡Нр┤▒р┤┐ р┤Ер┤▓р╡Нр┤▓р╡Жр┤Щр╡Нр┤Хр┤┐р╡╜ р┤╕р┤Вр┤Шр┤Яр┤и',
        'login_button': 'ЁЯФУ р┤▓р╡Лр┤Чр┤┐р╡╗',
        'register_button': 'тЬЕ р┤░р┤Ьр┤┐р┤╕р╡Нр┤▒р╡Нр┤▒р╡╝',
        'logout_button': 'ЁЯЪк р┤▓р╡Лр┤Чр╡Чр┤Яр╡Нр┤Яр╡Н',
        'welcome': 'р┤╕р╡Нр┤╡р┤╛р┤Чр┤др┤В',
        'navigation': 'р┤ир┤╛р┤╡р┤┐р┤Чр╡Зр┤╖р╡╗',
        'add_entry': 'ЁЯУЭ р┤кр╡Бр┤др┤┐р┤п р┤Ор╡╗р┤Яр╡Нр┤░р┤┐ р┤Ър╡Зр╡╝р┤Хр╡Нр┤Хр╡Бр┤Х',
        'view_submissions': 'ЁЯУЪ р┤╕р┤мр╡Нр┤ор┤┐р┤╖р┤ир╡Бр┤Хр╡╛ р┤Хр┤╛р┤гр╡Бр┤Х',
        'my_profile': 'ЁЯСд р┤Ор┤ир╡Нр┤▒р╡Ж р┤кр╡Нр┤░р╡Кр┤лр╡Ир╡╜',
        'invalid_credentials': 'р┤др╡Жр┤▒р╡Нр┤▒р┤╛р┤п р┤Йр┤кр┤пр╡Лр┤Хр╡Нр┤др╡Гр┤ир┤╛р┤ор┤В р┤Ер┤▓р╡Нр┤▓р╡Жр┤Щр╡Нр┤Хр┤┐р╡╜ р┤кр┤╛р┤╕р╡НтАМр┤╡р╡Зр┤бр╡Н',
        'passwords_not_match': 'р┤кр┤╛р┤╕р╡НтАМр┤╡р╡Зр┤бр╡Бр┤Хр╡╛ р┤кр╡Кр┤░р╡Бр┤др╡Нр┤др┤кр╡Нр┤кр╡Жр┤Яр╡Бр┤ир╡Нр┤ир┤┐р┤▓р╡Нр┤▓',
        'password_too_short': 'р┤кр┤╛р┤╕р╡НтАМр┤╡р╡Зр┤бр╡Н р┤Хр╡Бр┤▒р┤Юр╡Нр┤Юр┤др╡Н 6 р┤Ер┤Хр╡Нр┤╖р┤░р┤ор┤╛р┤пр┤┐р┤░р┤┐р┤Хр╡Нр┤Хр┤гр┤В',
        'username_required': 'р┤Йр┤кр┤пр╡Лр┤Хр╡Нр┤др╡Гр┤ир┤╛р┤ор┤╡р╡Бр┤В р┤кр┤╛р┤╕р╡НтАМр┤╡р╡Зр┤бр╡Бр┤В р┤Жр┤╡р┤╢р╡Нр┤пр┤ор┤╛р┤гр╡Н',
        'registration_successful': 'р┤░р┤Ьр┤┐р┤╕р╡Нр┤Яр╡Нр┤░р╡Зр┤╖р╡╗ р┤╡р┤┐р┤Ьр┤пр┤Хр┤░р┤В! р┤жр┤пр┤╡р┤╛р┤пр┤┐ р┤▓р╡Лр┤Чр┤┐р╡╗ р┤Ър╡Жр┤пр╡Нр┤пр╡Бр┤Х.',
        'username_exists': 'р┤Йр┤кр┤пр╡Лр┤Хр╡Нр┤др╡Гр┤ир┤╛р┤ор┤В р┤Зр┤др┤┐р┤ир┤Хр┤В р┤ир┤┐р┤▓р┤╡р┤┐р┤▓р╡Бр┤гр╡Нр┤Яр╡Н',
        'email_exists': 'р┤Зр┤ор╡Жр┤пр┤┐р╡╜ р┤Зр┤др┤┐р┤ир┤Хр┤В р┤ир┤┐р┤▓р┤╡р┤┐р┤▓р╡Бр┤гр╡Нр┤Яр╡Н',
        # Main form translations
        'app_main_title': 'ЁЯМ┐ р┤кр╡Нр┤▓р┤╛р┤ир╡Нр┤▒р╡НтАМр┤╕р╡Нр┤кр╡Ар┤Хр╡Нр┤Хр╡Н тАУ р┤кр┤░р┤ор╡Нр┤кр┤░р┤╛р┤Чр┤д р┤╕р┤╕р╡Нр┤п р┤Ер┤▒р┤┐р┤╡р╡Н р┤╕р┤Вр┤░р┤Хр╡Нр┤╖р┤┐р┤Хр╡Нр┤Хр┤╛р╡╗ р┤Юр┤Щр╡Нр┤Щр┤│р╡Ж р┤╕р┤╣р┤╛р┤пр┤┐р┤Хр╡Нр┤Хр╡Бр┤Х',
        'app_description': 'р┤кр┤▓ р┤ор╡Бр┤др┤┐р╡╝р┤ир╡Нр┤ир┤╡р╡╝р┤Хр╡Нр┤Хр╡Бр┤В р┤Хр╡╝р┤╖р┤Хр╡╝р┤Хр╡Нр┤Хр╡Бр┤В р┤╡р╡Ир┤жр╡Нр┤пр╡╝р┤Хр╡Нр┤Хр╡Бр┤В р┤кр╡Нр┤░р┤╛р┤жр╡Зр┤╢р┤┐р┤Х р┤╕р┤╕р╡Нр┤пр┤Щр╡Нр┤Щр┤│р╡Жр┤Хр╡Нр┤Хр╡Бр┤▒р┤┐р┤Ър╡Нр┤Ър╡Н р┤Ер┤Чр┤╛р┤зр┤ор┤╛р┤п р┤Ер┤▒р┤┐р┤╡р╡Бр┤гр╡Нр┤Яр╡Н тАФ р┤ор┤░р╡Бр┤ир╡Нр┤ир╡Бр┤Хр╡╛, р┤Жр┤Ър┤╛р┤░р┤Щр╡Нр┤Щр╡╛, р┤жр╡Ир┤ир┤Вр┤жр┤┐р┤и р┤Ьр╡Ар┤╡р┤┐р┤др┤др╡Нр┤др┤┐р╡╜ р┤Йр┤кр┤пр╡Лр┤Чр┤┐р┤Хр╡Нр┤Хр╡Бр┤ир╡Нр┤ир┤╡. р┤И р┤Жр┤кр╡Нр┤кр╡Н р┤Ж р┤Ер┤▒р┤┐р┤╡р╡Н р┤╢р╡Зр┤Цр┤░р┤┐р┤Хр╡Нр┤Хр┤╛р┤ир╡Бр┤В р┤╕р┤Вр┤░р┤Хр╡Нр┤╖р┤┐р┤Хр╡Нр┤Хр┤╛р┤ир╡Бр┤В р┤кр┤Щр╡Нр┤Хр┤┐р┤Яр┤╛р┤ир╡Бр┤В р┤╕р┤╣р┤╛р┤пр┤┐р┤Хр╡Нр┤Хр╡Бр┤ир╡Нр┤ир╡Б.',
        'step1_header': 'ЁЯУе р┤Шр┤Яр╡Нр┤Яр┤В 1: р┤╕р┤╕р╡Нр┤пр┤др╡Нр┤др┤┐р┤ир╡Нр┤▒р╡Ж р┤Ър┤┐р┤др╡Нр┤░р┤В р┤Ер┤кр╡НтАМр┤▓р╡Лр┤бр╡Н р┤Ър╡Жр┤пр╡Нр┤пр╡Бр┤Х р┤Ер┤▓р╡Нр┤▓р╡Жр┤Щр╡Нр┤Хр┤┐р╡╜ р┤др┤┐р┤░р┤┐р┤Ър╡Нр┤Ър┤▒р┤┐р┤пр╡Бр┤Х',
        'upload_photo': 'ЁЯУ╕ р┤╕р┤╕р╡Нр┤пр┤др╡Нр┤др┤┐р┤ир╡Нр┤▒р╡Ж р┤Ър┤┐р┤др╡Нр┤░р┤В р┤Ер┤кр╡НтАМр┤▓р╡Лр┤бр╡Н р┤Ър╡Жр┤пр╡Нр┤пр╡Бр┤Х (р┤Зр┤▓, р┤кр╡Вр┤╡р╡Н, р┤кр╡Бр┤▒р┤Вр┤др╡Лр┤Яр╡Н, р┤ор╡Бр┤др┤▓р┤╛р┤пр┤╡)',
        'plant_name_input': 'тЬНя╕П р┤╕р┤╕р╡Нр┤пр┤др╡Нр┤др┤┐р┤ир╡Нр┤▒р╡Ж р┤кр╡Зр┤░р╡Н р┤ир╡╜р┤Хр╡Бр┤Х (р┤Пр┤др╡Н р┤нр┤╛р┤╖р┤пр┤┐р┤▓р╡Бр┤В)',
        'entry_title_input': 'ЁЯУЭ р┤Ор╡╗р┤Яр╡Нр┤░р┤┐ р┤др┤▓р┤Хр╡Нр┤Хр╡Жр┤Яр╡Нр┤Яр╡Н (р┤Ур┤кр╡Нр┤╖р┤гр╡╜)',
        'step2_header': 'ЁЯз╛ р┤Шр┤Яр╡Нр┤Яр┤В 2: р┤ир┤┐р┤Щр╡Нр┤Щр┤│р╡Бр┤Яр╡Ж р┤Ер┤▒р┤┐р┤╡р╡Н р┤кр┤Щр╡Нр┤Хр┤┐р┤Яр╡Бр┤Х',
        'local_names_input': '1я╕ПтГг р┤╕р┤╕р╡Нр┤пр┤др╡Нр┤др┤┐р┤ир╡Нр┤▒р╡Ж р┤кр╡Нр┤░р┤╛р┤жр╡Зр┤╢р┤┐р┤Х р┤кр╡Зр┤░р╡Бр┤Хр╡╛',
        'scientific_name_input': '2я╕ПтГг р┤╢р┤╛р┤╕р╡Нр┤др╡Нр┤░р╡Ар┤п / р┤╕р┤╕р╡Нр┤пр┤╢р┤╛р┤╕р╡Нр┤др╡Нр┤░ р┤кр╡Зр┤░р╡Н (р┤Ур┤кр╡Нр┤╖р┤гр╡╜)',
        'category_select': '3я╕ПтГг р┤Йр┤кр┤пр╡Лр┤Ч р┤╡р┤┐р┤нр┤╛р┤Чр┤В',
        'usage_desc_input': '4я╕ПтГг р┤╕р┤╕р╡Нр┤пр┤др╡Нр┤др┤┐р┤ир╡Нр┤▒р╡Ж р┤Йр┤кр┤пр╡Лр┤Чр┤В р┤╡р┤┐р┤╡р┤░р┤┐р┤Хр╡Нр┤Хр╡Бр┤Х',
        'prep_method_input': '5я╕ПтГг р┤др┤пр╡Нр┤пр┤╛р┤▒р┤╛р┤Хр╡Нр┤Хр╡╜ р┤Ер┤▓р╡Нр┤▓р╡Жр┤Щр╡Нр┤Хр┤┐р╡╜ р┤кр╡Нр┤░р┤пр╡Лр┤Ч р┤кр╡Нр┤░р┤Хр╡Нр┤░р┤┐р┤п р┤╡р┤┐р┤╢р┤жр╡Ар┤Хр┤░р┤┐р┤Хр╡Нр┤Хр╡Бр┤Х',
        'community_input': '6я╕ПтГг р┤ир┤┐р┤Щр╡Нр┤Щр┤│р╡Бр┤Яр╡Ж р┤кр╡Нр┤░р┤жр╡Зр┤╢р┤др╡Нр┤др╡Н р┤И р┤╕р┤╕р╡Нр┤пр┤В р┤Жр┤░р┤╛р┤гр╡Н р┤Йр┤кр┤пр╡Лр┤Чр┤┐р┤Хр╡Нр┤Хр╡Бр┤ир╡Нр┤ир┤др╡Н?',
        'tags_input': 'ЁЯФЦ р┤Яр┤╛р┤Чр╡Бр┤Хр╡╛ р┤Ер┤▓р╡Нр┤▓р╡Жр┤Щр╡Нр┤Хр┤┐р╡╜ р┤Хр╡Ар┤╡р╡Зр┤бр╡Бр┤Хр╡╛ (р┤Ур┤кр╡Нр┤╖р┤гр╡╜)',
        'step3_header': 'ЁЯМН р┤Шр┤Яр╡Нр┤Яр┤В 3: р┤╕р╡Нр┤ер┤▓р┤╡р╡Бр┤В р┤нр┤╛р┤╖р┤пр╡Бр┤В',
        'location_input': '7я╕ПтГг р┤И р┤╕р┤╕р╡Нр┤пр┤В р┤Ор┤╡р┤┐р┤Яр╡Ж р┤Хр┤╛р┤гр┤кр╡Нр┤кр╡Жр┤Яр╡Бр┤ир╡Нр┤ир╡Б р┤Ер┤▓р╡Нр┤▓р╡Жр┤Щр╡Нр┤Хр┤┐р╡╜ р┤Йр┤кр┤пр╡Лр┤Чр┤┐р┤Хр╡Нр┤Хр╡Бр┤ир╡Нр┤ир╡Б?',
        'language_input': '8я╕ПтГг р┤ир┤┐р┤Щр╡Нр┤Щр┤│р╡Бр┤Яр╡Ж р┤нр┤╛р┤╖ р┤Ер┤▓р╡Нр┤▓р╡Жр┤Щр╡Нр┤Хр┤┐р╡╜ р┤кр╡Нр┤░р┤╛р┤жр╡Зр┤╢р┤┐р┤Х р┤нр┤╛р┤╖',
        'step4_header': 'ЁЯОд р┤Шр┤Яр╡Нр┤Яр┤В 4: р┤╢р┤мр╡Нр┤жр┤╡р╡Бр┤В р┤Яр╡Жр┤Хр╡Нр┤╕р╡Нр┤▒р╡Нр┤▒р╡Бр┤В р┤Ер┤зр┤┐р┤Х',
        'voice_upload': '9я╕ПтГг р┤╢р┤мр╡Нр┤ж р┤▒р╡Жр┤Хр╡Нр┤Хр╡Лр╡╝р┤бр┤┐р┤Вр┤Чр╡Н р┤Ер┤кр╡НтАМр┤▓р╡Лр┤бр╡Н р┤Ър╡Жр┤пр╡Нр┤пр╡Бр┤Х',
        'notes_upload': 'ЁЯФа 10я╕ПтГг р┤Хр╡Ир┤пр╡Жр┤┤р╡Бр┤др╡Нр┤др╡Н р┤Ер┤▓р╡Нр┤▓р╡Жр┤Щр╡Нр┤Хр┤┐р╡╜ р┤Ер┤Ър╡Нр┤Ър┤Яр┤┐р┤Ър╡Нр┤Ъ р┤Хр╡Бр┤▒р┤┐р┤кр╡Нр┤кр╡Бр┤Хр╡╛ р┤Ер┤кр╡НтАМр┤▓р╡Лр┤бр╡Н р┤Ър╡Жр┤пр╡Нр┤пр╡Бр┤Х',
        'step5_header': 'ЁЯСд р┤Шр┤Яр╡Нр┤Яр┤В 5: р┤ир┤┐р┤Щр╡Нр┤Щр┤│р╡Жр┤Хр╡Нр┤Хр╡Бр┤▒р┤┐р┤Ър╡Нр┤Ър╡Н',
        'age_group_select': '1я╕ПтГг1я╕ПтГг р┤ир┤┐р┤Щр╡Нр┤Щр┤│р╡Бр┤Яр╡Ж р┤кр╡Нр┤░р┤╛р┤п р┤╡р┤┐р┤нр┤╛р┤Чр┤В',
        'submit_button': 'ЁЯУд р┤ир┤┐р┤Щр╡Нр┤Щр┤│р╡Бр┤Яр╡Ж р┤╕р┤Вр┤нр┤╛р┤╡р┤и р┤╕р┤ор╡╝р┤кр╡Нр┤кр┤┐р┤Хр╡Нр┤Хр╡Бр┤Х'
    }
}

# Function to get translation
def get_text(key, lang='English'):
    """Get translated text based on selected language"""
    return LANGUAGES.get(lang, LANGUAGES['English']).get(key, key)

# Initialize language in session state
if 'selected_language' not in st.session_state:
    st.session_state.selected_language = 'English'

# Database setup
def init_db():
    """Initialize the SQLite database with tables for users and submissions"""
    # Use timeout to wait for lock to be released (5 seconds)
    conn = sqlite3.connect('plantspeak.db', timeout=5.0)
    c = conn.cursor()
    
    try:
        # Begin transaction
        conn.execute('BEGIN IMMEDIATE')
        
        # Create users table
        c.execute('''
        CREATE TABLE IF NOT EXISTS users (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            username TEXT UNIQUE NOT NULL,
            password TEXT NOT NULL,
            name TEXT,
            email TEXT UNIQUE,
            role TEXT,
            community TEXT,
            registration_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
        ''')
        
        # Create submissions table
        c.execute('''
        CREATE TABLE IF NOT EXISTS submissions (
            id TEXT PRIMARY KEY,
            user_id INTEGER,
            submission_time TIMESTAMP,
            plant_name TEXT NOT NULL,
            entry_title TEXT,
            local_names TEXT,
            scientific_name TEXT,
            category TEXT,
            usage_desc TEXT,
            prep_method TEXT,
            community TEXT,
            tags TEXT,
            location TEXT,
            language TEXT,
            latitude REAL,
            longitude REAL,
            photo_path TEXT,
            voice_path TEXT,
            notes_path TEXT,
            age_group TEXT,
            submitter_role TEXT,
            submitter_name TEXT,
            contact_info TEXT,
            consent TEXT,
            FOREIGN KEY (user_id) REFERENCES users (id)
        )
        ''')
        
        conn.commit()
    except sqlite3.OperationalError as e:
        # Handle locked database
        print(f"Database initialization error: {e}")
        conn.rollback()
    except Exception as e:
        # Handle other errors
        print(f"Unexpected error during db initialization: {e}")
        conn.rollback()
    finally:
        conn.close()

# Password handling
def hash_password(password):
    """Convert password to secure hash"""
    return hashlib.sha256(password.encode()).hexdigest()

def verify_password(stored_password, provided_password):
    """Verify the provided password against stored hash"""
    return stored_password == hash_password(provided_password)

# User management
def add_user(username, password, name='', email='', role='', community=''):
    """Add a new user to the database"""
    # Use timeout to wait for lock to be released (5 seconds)
    conn = sqlite3.connect('plantspeak.db', timeout=5.0)
    c = conn.cursor()
    hashed_pw = hash_password(password)
    success = False
    
    try:
        # Enable immediate transactions to reduce lock time
        conn.execute('BEGIN IMMEDIATE')
        c.execute(
            "INSERT INTO users (username, password, name, email, role, community) VALUES (?, ?, ?, ?, ?, ?)",
            (username, hashed_pw, name, email, role, community)
        )
        conn.commit()
        success = True
    except sqlite3.IntegrityError:
        # Handle duplicate username/email
        conn.rollback()
        success = False
    except sqlite3.OperationalError as e:
        # Handle locked database
        conn.rollback()
        print(f"Database error: {e}")
        success = False
    except Exception as e:
        # Handle any other errors
        conn.rollback()
        print(f"Unexpected error: {e}")
        success = False
    finally:
        conn.close()
    
    return success

def authenticate_user(username, password):
    """Check if username and password match a user in database"""
    conn = sqlite3.connect('plantspeak.db')
    c = conn.cursor()
    
    c.execute("SELECT password FROM users WHERE username = ?", (username,))
    result = c.fetchone()
    conn.close()
    
    if result:
        return verify_password(result[0], password)
    return False

def get_user_info(username):
    """Get user details from database"""
    conn = sqlite3.connect('plantspeak.db')
    c = conn.cursor()
    
    c.execute("SELECT id, username, name, email, role, community FROM users WHERE username = ?", (username,))
    result = c.fetchone()
    conn.close()
    
    if result:
        return {
            "id": result[0],
            "username": result[1],
            "name": result[2],
            "email": result[3],
            "role": result[4],
            "community": result[5]
        }
    return None

# User session management
def check_login_status():
    """Check if a user is logged in"""
    if 'logged_in' not in st.session_state:
        st.session_state.logged_in = False
        st.session_state.username = None
        st.session_state.user_info = None
    
    return st.session_state.logged_in

def login_user(username):
    """Set session state for logged in user"""
    st.session_state.logged_in = True
    st.session_state.username = username
    st.session_state.user_info = get_user_info(username)

def logout_user():
    """Clear session state for logout"""
    st.session_state.logged_in = False
    st.session_state.username = None
    st.session_state.user_info = None

def update_user_profile(user_id, name=None, email=None, role=None, community=None, password=None):
    """Update user profile information in the database"""
    conn = sqlite3.connect('plantspeak.db')
    c = conn.cursor()
    
    update_fields = []
    params = []
    
    # Build the update query based on which fields are provided
    if name is not None:
        update_fields.append("name = ?")
        params.append(name)
    if email is not None:
        update_fields.append("email = ?")
        params.append(email)
    if role is not None:
        update_fields.append("role = ?")
        params.append(role)
    if community is not None:
        update_fields.append("community = ?")
        params.append(community)
    if password is not None:
        update_fields.append("password = ?")
        params.append(hash_password(password))
    
    # If there are fields to update
    if update_fields:
        # Add user_id to the params
        params.append(user_id)
        
        query = f"UPDATE users SET {', '.join(update_fields)} WHERE id = ?"
        
        try:
            c.execute(query, params)
            conn.commit()
            success = True
        except sqlite3.IntegrityError as e:
            # Most likely due to duplicate email
            print(f"Database update error: {e}")
            success = False
        finally:
            conn.close()
        
        return success
    
    conn.close()
    return False  # No fields to update

# Submission database functions
def save_submission_to_db(
    submission_id, user_id, submission_time, plant_name, entry_title, local_names, scientific_name,
    category, usage_desc, prep_method, community, tags, location, language, lat, lon,
    photo_path, voice_path, notes_path, age_group="", submitter_role="", submitter_name="", contact_info="", consent=""
):
    """Save a plant submission to the database"""
    # Use timeout to wait for lock to be released (5 seconds)
    conn = sqlite3.connect('plantspeak.db', timeout=5.0)
    c = conn.cursor()
    success = False
    
    try:
        # Enable immediate transactions to reduce lock time
        conn.execute('BEGIN IMMEDIATE')
        c.execute('''
            INSERT INTO submissions (
                id, user_id, submission_time, plant_name, entry_title, local_names, scientific_name,
                category, usage_desc, prep_method, community, tags, location, language,
                latitude, longitude, photo_path, voice_path, notes_path, age_group, submitter_role,
                submitter_name, contact_info, consent
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
        ''', (
            submission_id, user_id, submission_time, plant_name, entry_title, local_names, scientific_name,
            category, usage_desc, prep_method, community, tags, location, language, lat, lon,
            photo_path, voice_path, notes_path, age_group, submitter_role, submitter_name, contact_info, consent
        ))
        
        conn.commit()
        success = True
    except sqlite3.OperationalError as e:
        # Handle locked database
        conn.rollback()
        print(f"Database locked error: {e}")
        success = False
    except Exception as e:
        # Handle other errors
        conn.rollback()
        print(f"Database error: {e}")
        success = False
    finally:
        conn.close()
    
    return success

def get_user_submissions(user_id=None):
    """
    Get all submissions, optionally filtered by user_id.
    If user_id is provided, show all submissions by that user and public submissions by others.
    If user_id is None, only show public submissions (those with consent != 'No, keep private')
    """
    conn = sqlite3.connect('plantspeak.db')
    conn.row_factory = sqlite3.Row  # This enables column access by name
    c = conn.cursor()
    
    if user_id:
        # For logged-in users, show:
        # 1. All of their own submissions
        # 2. Public submissions from others
        c.execute('''
            SELECT s.*, u.username, u.name as submitter_name
            FROM submissions s
            LEFT JOIN users u ON s.user_id = u.id
            WHERE s.user_id = ? OR (s.consent != 'No, keep private' AND s.consent IS NOT NULL)
            ORDER BY s.submission_time DESC
        ''', (user_id,))
    else:
        # For anonymous users or when not filtering by user, show only public submissions
        c.execute('''
            SELECT s.*, u.username, u.name as submitter_name
            FROM submissions s
            LEFT JOIN users u ON s.user_id = u.id
            WHERE s.consent != 'No, keep private' AND s.consent IS NOT NULL
            ORDER BY s.submission_time DESC
        ''')
        
    results = [dict(row) for row in c.fetchall()]
    conn.close()
    
    return results

# Initialize the database
init_db()

# Function to get location name from coordinates using OpenStreetMap's Nominatim API
def get_location_from_coords(lat, lon):
    try:
        url = f"https://nominatim.openstreetmap.org/reverse?lat={lat}&lon={lon}&format=json"
        headers = {"User-Agent": "PlantSpeakApp/1.0"}
        response = requests.get(url, headers=headers)
        if response.status_code == 200:
            data = response.json()
            if "display_name" in data:
                return data["display_name"]
        return None
    except Exception as e:
        st.error(f"Error getting location: {e}")
        return None

# Function to get coordinates from a location name
def get_coords_from_location(location_name):
    try:
        url = f"https://nominatim.openstreetmap.org/search?q={location_name}&format=json"
        headers = {"User-Agent": "PlantSpeakApp/1.0"}
        response = requests.get(url, headers=headers)
        if response.status_code == 200:
            data = response.json()
            if data and len(data) > 0:
                return float(data[0]["lat"]), float(data[0]["lon"])
        return None, None
    except Exception as e:
        st.error(f"Error geocoding location: {e}")
        return None, None

# Initialize language in session state first
if 'selected_language' not in st.session_state:
    st.session_state.selected_language = 'English'

st.set_page_config(
    page_title=get_text('app_title', st.session_state.selected_language), 
    layout="wide"
)

# Check login status
is_logged_in = check_login_status()

# Initialize page selection in session state if not present
if 'page' not in st.session_state:
    st.session_state.page = 'login' if not is_logged_in else 'main'

# Sidebar navigation when logged in
if is_logged_in:
    st.sidebar.title(f"ЁЯСд {get_text('welcome', st.session_state.selected_language)}, {st.session_state.username}!")
    
    # Language selector in sidebar
    st.sidebar.subheader("ЁЯМН Language / рднрд╛рд╖рд╛ / р░нр░╛р░╖")
    language_options = ['English', 'рд╣рд┐рдВрджреА', 'р░др▒Жр░▓р▒Бр░Чр▒Б', 'родрооро┐ро┤рпН', 'р▓Хр▓ир│Нр▓ир▓б', 'рдорд░рд╛рдареА', 'р┤ор┤▓р┤пр┤╛р┤│р┤В']
    selected_lang = st.sidebar.selectbox(
        "Choose language:",
        language_options,
        index=language_options.index(st.session_state.selected_language)
    )
    
    # Update language if changed
    if selected_lang != st.session_state.selected_language:
        st.session_state.selected_language = selected_lang
        st.rerun()
    
    # Navigation options
    st.sidebar.subheader(get_text('navigation', st.session_state.selected_language))
    page = st.sidebar.radio(
        "Go to:", 
        [
            get_text('add_entry', st.session_state.selected_language), 
            get_text('view_submissions', st.session_state.selected_language), 
            get_text('my_profile', st.session_state.selected_language)
        ]
    )
    
    # Map selection to session state
    if page == get_text('add_entry', st.session_state.selected_language):
        st.session_state.page = 'main'
    elif page == get_text('view_submissions', st.session_state.selected_language):
        st.session_state.page = 'submissions'
    elif page == get_text('my_profile', st.session_state.selected_language):
        st.session_state.page = 'profile'
    
    # Logout button
    if st.sidebar.button(get_text('logout_button', st.session_state.selected_language)):
        logout_user()
        st.session_state.page = 'login'
        st.rerun()

# Login/Register Interface when not logged in
if not is_logged_in:
    # Language selection at the top
    st.header("ЁЯМН " + get_text('select_language', st.session_state.selected_language))
    
    # Create columns for language selection
    lang_cols = st.columns(7)
    language_options = ['English', 'рд╣рд┐рдВрджреА', 'р░др▒Жр░▓р▒Бр░Чр▒Б', 'родрооро┐ро┤рпН', 'р▓Хр▓ир│Нр▓ир▓б', 'рдорд░рд╛рдареА', 'р┤ор┤▓р┤пр┤╛р┤│р┤В']
    
    for i, lang in enumerate(language_options):
        with lang_cols[i]:
            if st.button(lang, key=f"lang_{lang}"):
                st.session_state.selected_language = lang
                st.rerun()
    
    # Display current language selection
    st.info(f"Selected Language / рдЪреБрдиреА рдЧрдИ рднрд╛рд╖рд╛ / р░Ор░Вр░Ър▒Бр░Хр▒Бр░ир▒Нр░и р░нр░╛р░╖: **{st.session_state.selected_language}**")
    
    # Choose between login and registration with translated text
    login_tab, register_tab = st.tabs([
        f"ЁЯФС {get_text('login', st.session_state.selected_language)}", 
        f"ЁЯУЭ {get_text('register', st.session_state.selected_language)}"
    ])
    
    with login_tab:
        st.header(get_text('login_header', st.session_state.selected_language))
        
        login_username = st.text_input(
            get_text('username', st.session_state.selected_language), 
            key="login_username"
        )
        login_password = st.text_input(
            get_text('password', st.session_state.selected_language), 
            type="password", 
            key="login_password"
        )
        
        col1, col2 = st.columns([1, 3])
        with col1:
            login_button = st.button(get_text('login_button', st.session_state.selected_language))
        
        if login_button:
            if authenticate_user(login_username, login_password):
                login_user(login_username)
                st.session_state.page = 'main'
                st.success(f"{get_text('welcome', st.session_state.selected_language)}, {login_username}!")
                st.rerun()
            else:
                st.error(get_text('invalid_credentials', st.session_state.selected_language))
    
    with register_tab:
        st.header(get_text('register_header', st.session_state.selected_language))
        
        reg_username = st.text_input(
            get_text('username', st.session_state.selected_language) + " (required)", 
            key="reg_username"
        )
        reg_password = st.text_input(
            get_text('password', st.session_state.selected_language) + " (required)", 
            type="password", 
            key="reg_password"
        )
        reg_password_confirm = st.text_input(
            get_text('confirm_password', st.session_state.selected_language), 
            type="password", 
            key="reg_password_confirm"
        )
        
        reg_name = st.text_input(get_text('full_name', st.session_state.selected_language), key="reg_name")
        reg_email = st.text_input(get_text('email', st.session_state.selected_language), key="reg_email")
        reg_role = st.text_input(get_text('role', st.session_state.selected_language), key="reg_role")
        reg_community = st.text_input(get_text('community', st.session_state.selected_language), key="reg_community")
        
        register_button = st.button(get_text('register_button', st.session_state.selected_language))
        
        if register_button:
            # Basic validation with translated error messages
            if not reg_username or not reg_password:
                st.error(get_text('username_required', st.session_state.selected_language))
            elif reg_password != reg_password_confirm:
                st.error(get_text('passwords_not_match', st.session_state.selected_language))
            elif len(reg_password) < 6:
                st.error(get_text('password_too_short', st.session_state.selected_language))
            elif reg_email and not re.match(r"[^@]+@[^@]+\.[^@]+", reg_email):
                st.error("Please enter a valid email address")  # Keep in English as it's technical
            else:
                if add_user(reg_username, reg_password, reg_name, reg_email, reg_role, reg_community):
                    st.success(get_text('registration_successful', st.session_state.selected_language))
                    # Auto-login after registration
                    login_user(reg_username)
                    st.session_state.page = 'main'
                    st.rerun()
                else:
                    st.error(get_text('username_exists', st.session_state.selected_language))

# Main app only shown when logged in
if is_logged_in:
    # Declare tab variables at a higher scope so they can be checked before use
    tab1 = None
    tab2 = None
    
    if st.session_state.page == 'main' or st.session_state.page == 'submissions':
        # Create tabs for data entry and viewing data based on page selection
        tab1, tab2 = st.tabs(["ЁЯУЭ Add New Entry", "ЁЯУЪ View Submissions"])
        
        # Set which tab is active based on page selection
        if st.session_state.page == 'submissions':
            # This makes the second tab active
            tab2.active = True
    
    elif st.session_state.page == 'profile':
        # User profile page
        st.title("ЁЯСд My Profile")
        
        user_info = st.session_state.user_info
        
        col1, col2 = st.columns(2)
        
        with col1:
            st.subheader("Account Information")
            st.write(f"**Username:** {user_info['username']}")
            st.write(f"**Name:** {user_info['name'] or 'Not provided'}")
            st.write(f"**Email:** {user_info['email'] or 'Not provided'}")
            st.write(f"**Role:** {user_info['role'] or 'Not specified'}")
            st.write(f"**Community:** {user_info['community'] or 'Not specified'}")
        
        with col2:
            st.subheader("Statistics")
            
            # Get user submissions from database
            user_submissions = get_user_submissions(user_info['id'])
            st.write(f"**Your contributions:** {len(user_submissions)}")
        
        # Profile update form
        st.subheader("Update Profile")
        
        with st.form("profile_update_form"):
            update_name = st.text_input("Full Name", value=user_info['name'] or "")
            update_email = st.text_input("Email", value=user_info['email'] or "")
            update_role = st.text_input("Role (e.g., Farmer, Healer, Researcher)", value=user_info['role'] or "")
            update_community = st.text_input("Community or Organization", value=user_info['community'] or "")
            
            # Password change section
            st.subheader("Change Password (Optional)")
            update_password = st.text_input("New Password", type="password")
            confirm_password = st.text_input("Confirm New Password", type="password")
            
            submit_button = st.form_submit_button("Update Profile")
            
        if submit_button:
            # Validate input
            if update_email and not re.match(r"[^@]+@[^@]+\.[^@]+", update_email):
                st.error("Please enter a valid email address")
            elif update_password and len(update_password) < 6:
                st.error("Password must be at least 6 characters long")
            elif update_password and update_password != confirm_password:
                st.error("Passwords do not match")
            else:
                # Only update password if a new one was provided
                password_to_update = update_password if update_password else None
                
                # Update profile in database
                if update_user_profile(
                    user_info['id'], 
                    name=update_name, 
                    email=update_email, 
                    role=update_role, 
                    community=update_community,
                    password=password_to_update
                ):
                    st.success("Profile updated successfully!")
                    
                    # Update the session state with new information
                    user_info['name'] = update_name
                    user_info['email'] = update_email
                    user_info['role'] = update_role
                    user_info['community'] = update_community
                    st.session_state.user_info = user_info
                    
                    # Refresh the page to show the updated information
                    st.rerun()
                else:
                    st.error("Failed to update profile. The email may already be in use.")
        
## Only proceed with content tabs if we're on a page that has them and tabs are created
if not is_logged_in:
    # Not logged in: show nothing (login/register UI is already shown above)
    pass
elif tab1 is not None and st.session_state.page not in ['profile']:
    # Tab 1 - Add New Entry
    with tab1:
        st.title(get_text('app_main_title', st.session_state.selected_language))

        st.markdown(get_text('app_description', st.session_state.selected_language))
        
        st.header(get_text('step1_header', st.session_state.selected_language))
        photo = st.file_uploader(get_text('upload_photo', st.session_state.selected_language), type=["jpg", "jpeg", "png"])
        plant_name = st.text_input(get_text('plant_name_input', st.session_state.selected_language))
        entry_title = st.text_input(get_text('entry_title_input', st.session_state.selected_language), help="A title for your submission")

        st.header(get_text('step2_header', st.session_state.selected_language))
        local_names = st.text_area(get_text('local_names_input', st.session_state.selected_language), help="List local names in various languages or dialects")
        scientific_name = st.text_input(get_text('scientific_name_input', st.session_state.selected_language))

        category = st.multiselect(get_text('category_select', st.session_state.selected_language), [
            "Medicinal", "Food / Cooking", "Religious / Ritual",
            "Ecological / Environmental", "Craft / Utility", "Other"
        ])

        usage_desc = st.text_area(get_text('usage_desc_input', st.session_state.selected_language), help="E.g., Used to treat fever, offered in rituals, made into tea")
        prep_method = st.text_area(get_text('prep_method_input', st.session_state.selected_language), help="How is it prepared, how much is used, and how often?")
        community = st.text_input(get_text('community_input', st.session_state.selected_language), help="Mention tribe, village, or community")
        tags = st.text_input(get_text('tags_input', st.session_state.selected_language), help="Separate by commas, e.g. headache, fever, forest plant")

        st.header(get_text('step3_header', st.session_state.selected_language))
        location = st.text_input(get_text('location_input', st.session_state.selected_language), help="Village, District, State")
        language = st.text_input(get_text('language_input', st.session_state.selected_language))

        st.write("ЁЯУН **Geographic Location**")
        
        # Options for location entry
        loc_tab1, loc_tab2, loc_tab3 = st.tabs(["я┐╜ Enter Name", "ЁЯУ▒ Auto-Detect", "ЁЯФН Enter Coordinates"])
        
        # Container for location controls and map
        location_container = st.container()
        
        # Define session state to track changes in lat/lon
        if 'prev_lat' not in st.session_state:
            st.session_state.prev_lat = 0.0
        if 'prev_lon' not in st.session_state:
            st.session_state.prev_lon = 0.0
        
        # Tab 1: Search location by name
        with loc_tab1:
            search_loc = st.text_input("ЁЯФН Search for a location", help="Enter a place name, landmark, or address")
            if search_loc:
                if st.button("ЁЯФО Find Location"):
                    with st.spinner("Searching location..."):
                        found_lat, found_lon = get_coords_from_location(search_loc)
                        if found_lat and found_lon:
                            st.session_state.temp_lat = found_lat
                            st.session_state.temp_lon = found_lon
                            st.success(f"Found coordinates: {found_lat}, {found_lon}")
                            st.rerun()
                        else:
                            st.error(f"Could not find location: {search_loc}")
        
        # Tab 2: Auto-detect location
        with loc_tab2:
            # Auto-location functionality
            st.info("This feature uses IP-based geolocation and may not be precise. Results may vary based on network setup.")
            
            if st.button("ЁЯУ▒ Get My Location (Approx)"):
                # Use a free IP-based geolocation service
                try:
                    with st.spinner("Getting your approximate location..."):
                        ip_location_url = "https://ipapi.co/json/"
                        st.write("Making request to geolocation service...")
                        
                        response = requests.get(ip_location_url, timeout=10)
                        st.write(f"Received response with status code: {response.status_code}")
                        
                        if response.status_code == 200:
                            data = response.json()
                            st.write("Data received from geolocation service:", data)
                            
                            if "latitude" in data and "longitude" in data:
                                # Update session state to trigger rerun with new values
                                lat_value = data["latitude"]
                                lon_value = data["longitude"]
                                st.session_state.temp_lat = lat_value
                                st.session_state.temp_lon = lon_value
                                st.success(f"Located at approximately: {lat_value}, {lon_value}")
                                
                                # Display direct map to confirm location before rerun
                                st.map(data=pd.DataFrame({'lat': [lat_value], 'lon': [lon_value]}), zoom=10)
                                
                                if st.button("тЬЕ Use This Location"):
                                    st.rerun()
                            else:
                                st.error("Location coordinates not found in API response")
                        else:
                            st.error(f"API request failed with status code: {response.status_code}")
                except Exception as e:
                    st.error(f"Could not detect location: {str(e)}")
                    import traceback
                    st.error(f"Error details: {traceback.format_exc()}")
        
            st.write("Or use an online service:")
            st.markdown("[ЁЯФН Find My Coordinates](https://www.latlong.net/) (copy & paste back here)")
        
        # Tab 3: Manual coordinate entry
        with loc_tab3:
            col1, col2 = st.columns(2)
            
            with col1:
                lat = st.number_input("ЁЯУМ Latitude", format="%.6f")
            
            with col2:
                lon = st.number_input("ЁЯУМ Longitude", format="%.6f")
        
        # Display map with the coordinates
        if lat != 0 and lon != 0:
            st.map(data=pd.DataFrame({'lat': [lat], 'lon': [lon]}), zoom=12)
            
            # Check if coordinates have changed significantly (at least 0.0001 degrees difference)
            coords_changed = (abs(lat - st.session_state.prev_lat) > 0.0001 or 
                             abs(lon - st.session_state.prev_lon) > 0.0001)
            
            # Auto-fill location name if valid coordinates and they've changed
            if coords_changed:
                st.session_state.prev_lat = lat
                st.session_state.prev_lon = lon
                
                # Add a button to get location name from coordinates
                if st.button("ЁЯУН Get Location Name from Coordinates") or (location == "" and coords_changed):
                    with st.spinner("Getting location name..."):
                        place_name = get_location_from_coords(lat, lon)
                        if place_name:
                            # Store in session state to update on next rerun
                            st.session_state.location_name = place_name
                            st.success(f"Location detected: {place_name}")
                            if location == "":
                                st.rerun()
        
        # Apply detected location name if available
        if hasattr(st.session_state, 'location_name') and location == "":
            location = st.session_state.location_name
            del st.session_state.location_name

        # Check if we have temp coordinates to apply from auto-detection or search
        if hasattr(st.session_state, 'temp_lat') and hasattr(st.session_state, 'temp_lon'):
            lat = st.session_state.temp_lat
            lon = st.session_state.temp_lon
            # Clear the temporary values
            del st.session_state.temp_lat
            del st.session_state.temp_lon

        # Step 4: Voice & Text Extras
        st.header(get_text('step4_header', st.session_state.selected_language))
        voice_note = st.file_uploader(get_text('voice_upload', st.session_state.selected_language), type=["mp3", "wav", "m4a"])
        notes_scan = st.file_uploader(get_text('notes_upload', st.session_state.selected_language), type=["jpg", "jpeg", "png", "pdf"])

        # Step 5: About You
        st.header(get_text('step5_header', st.session_state.selected_language))
        age_group = st.selectbox(get_text('age_group_select', st.session_state.selected_language), ["", "18тАУ30", "31тАУ50", "51тАУ70", "70+"])
        role = st.text_input("Your Role", help="Farmer, Healer, Grandparent, Herbalist, Teacher, Student, etc.")
        user_name = st.text_input("Your Name")
        contact_info = st.text_input("Contact Info (Email/Phone)")
        consent = st.radio("1я╕ПтГг2я╕ПтГг Do You Give Permission to Use This Data?", [
            "Yes, I give permission (anonymously)", "No, keep private"
        ])

        if st.button(get_text('submit_button', st.session_state.selected_language)):
            # Validate the required fields
            missing_fields = []
            
            if not plant_name:
                missing_fields.append("Plant name")
            if not voice_note:
                missing_fields.append("Voice recording")
            if not notes_scan:
                missing_fields.append("Handwritten or printed notes")
            if not age_group or age_group == "":
                missing_fields.append("Age group")
            if not role:
                missing_fields.append("Your role")
            if not user_name:
                missing_fields.append("Your name")
            if not contact_info:
                missing_fields.append("Contact information")
            
            if missing_fields:
                st.error(f"Please fill in all required fields: {', '.join(missing_fields)}")
            else:
                st.success("Thank you for sharing your knowledge! Your input will help preserve traditional plant wisdom.")

                # Generate a unique ID for this submission
                submission_id = str(uuid.uuid4())[:8]
                submission_time = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
                st.write("Submitted at:", submission_time)
                st.write("Submission ID:", submission_id)
            
            # File paths for uploaded media
            photo_path = ""
            voice_path = ""
            notes_path = ""
            
            # Save photo if uploaded
            if photo:
                file_ext = os.path.splitext(photo.name)[1]
                photo_path = f"uploads/photos/{submission_id}{file_ext}"
                try:
                    with open(photo_path, "wb") as f:
                        f.write(photo.getbuffer())
                except Exception as e:
                    st.error(f"Error saving photo: {e}")
            
            # Save voice note if uploaded
            if voice_note:
                file_ext = os.path.splitext(voice_note.name)[1]
                voice_path = f"uploads/voice/{submission_id}{file_ext}"
                try:
                    with open(voice_path, "wb") as f:
                        f.write(voice_note.getbuffer())
                except Exception as e:
                    st.error(f"Error saving voice recording: {e}")
                    
            # Save notes scan if uploaded
            if notes_scan:
                file_ext = os.path.splitext(notes_scan.name)[1]
                notes_path = f"uploads/notes/{submission_id}{file_ext}"
                try:
                    with open(notes_path, "wb") as f:
                        f.write(notes_scan.getbuffer())
                except Exception as e:
                    st.error(f"Error saving notes scan: {e}")

            # Add user information from session
            user_id = st.session_state.user_info['id'] if st.session_state.user_info else None
            submitter_name = st.session_state.user_info['name'] if st.session_state.user_info else user_name
            
            # Save structured data to CSV
            row = [submission_id, submission_time, plant_name, entry_title, local_names, scientific_name, 
                   ", ".join(category) if category else "", usage_desc, prep_method, community, tags,
                   location, language, lat, lon, age_group, role, submitter_name, contact_info, consent,
                   photo_path if photo else "", voice_path if voice_note else "", notes_path if notes_scan else "",
                   user_id]

            file_path = "plantspeak_submissions.csv"
            header = ["ID", "Time", "Plant Name", "Entry Title", "Local Names", "Scientific Name", "Category", 
                      "Usage Description", "Preparation Method", "Community", "Tags", "Location", "Language", 
                      "Latitude", "Longitude", "Age Group", "Role", "Name", "Contact", "Consent",
                      "Photo Path", "Voice Path", "Notes Path", "User ID"]
                      
            # Store in SQLite database
            db_save_success = save_submission_to_db(
                submission_id, user_id, submission_time, plant_name, entry_title, local_names, scientific_name,
                ", ".join(category) if category else "", usage_desc, prep_method, community, tags,
                location, language, lat, lon, photo_path, voice_path, notes_path, 
                age_group, role, user_name, contact_info, consent
            )
            
            if db_save_success:
                st.success("Submission saved to database successfully")
            else:
                st.warning("Note: Your submission was saved locally but there was an issue with the database. An administrator has been notified.")
            
            # Also save to CSV for backwards compatibility
            if not os.path.exists(file_path):
                with open(file_path, mode='w', newline='', encoding='utf-8') as f:
                    writer = csv.writer(f)
                    writer.writerow(header)
                    writer.writerow(row)
            else:
                with open(file_path, mode='a', newline='', encoding='utf-8') as f:
                    writer = csv.writer(f)
                    writer.writerow(row)

        # Display uploaded content
        if photo:
            st.image(photo, caption="Uploaded Plant Photo", use_column_width=True)
            st.success(f"Photo saved as {os.path.basename(photo_path)}")

        if notes_scan:
            if notes_scan.type == "application/pdf":
                st.write("PDF uploaded: ", notes_scan.name)
                st.success(f"Notes saved as {os.path.basename(notes_path)}")
            else:
                st.image(notes_scan, caption="Scanned Notes", use_column_width=True)
                st.success(f"Notes saved as {os.path.basename(notes_path)}")

        if voice_note:
            st.audio(voice_note, format='audio/wav')
            st.success(f"Voice recording saved as {os.path.basename(voice_path)}")
            
        # Display summary of submission
        st.subheader("ЁЯУЛ Submission Summary")
        # Use current time for the summary if submission hasn't been made yet
        current_time = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        summary_data = {
            "Plant Name": plant_name,
            "Entry Title": entry_title if entry_title else "Not provided",
            "Categories": ", ".join(category) if category else "None selected",
            "Location": location if location else "Not provided",
            "Date & Time": current_time
        }
        st.json(summary_data)

    # Tab 2 - View Submissions
    if tab2 is not None:
        with tab2:
            st.title("ЁЯУЪ Past Submissions")
            
            # Load submissions from database
            # Get current user ID if logged in
            current_user_id = st.session_state.user_info['id'] if 'user_info' in st.session_state else None
            
            # Get submissions, filtered by privacy settings
            submissions_list = get_user_submissions(current_user_id)
            
            # Convert to dataframe for easier filtering
            if submissions_list:
                submissions_df = pd.DataFrame(submissions_list)
                
                # Add filtering options
                st.subheader("ЁЯФН Filter Submissions")
                col1, col2, col3 = st.columns(3)
        
                with col1:
                    # Filter by category
                    all_categories = set()
                    for cats in submissions_df['category'].dropna():
                        for cat in cats.split(", "):
                            if cat:
                                all_categories.add(cat)
                    
                    selected_category = st.selectbox(
                        "Filter by Category", 
                        ["All"] + sorted(list(all_categories))
                    )
                
                with col2:
                    # Search by plant name or location
                    search_term = st.text_input("Search by Plant Name or Location")
                
                with col3:
                    # Filter by user
                    show_only_mine = st.checkbox("Show only my submissions", value=False)
                
                # Apply filters
                filtered_df = submissions_df.copy()
                
                if selected_category and selected_category != "All":
                    filtered_df = filtered_df[filtered_df['category'].str.contains(selected_category, na=False)]
                    
                if search_term:
                    name_matches = filtered_df['plant_name'].str.contains(search_term, case=False, na=False)
                    location_matches = filtered_df['location'].str.contains(search_term, case=False, na=False)
                    filtered_df = filtered_df[name_matches | location_matches]
                    
                if show_only_mine and st.session_state.user_info:
                    filtered_df = filtered_df[filtered_df['user_id'] == st.session_state.user_info['id']]
                    
                # Show filtered results
                st.subheader(f"Showing {len(filtered_df)} submissions")
                
                # Display a more user-friendly version of the dataframe
                display_df = filtered_df[['id', 'plant_name', 'entry_title', 'scientific_name', 
                                         'category', 'location', 'submission_time', 'submitter_name']]
                display_df.columns = ['ID', 'Plant Name', 'Title', 'Scientific Name', 
                                     'Category', 'Location', 'Date & Time', 'Submitted By']
                st.dataframe(display_df)
                
                # Display selected entry
                if not filtered_df.empty:
                    st.subheader("ЁЯУЦ View Details")
                    submission_ids = filtered_df['id'].tolist()
                    submission_names = [f"{row['plant_name']} ({row['id']})" for _, row in filtered_df.iterrows()]
                    selected_idx = st.selectbox("Select a submission to view details", 
                                              range(len(submission_ids)),
                                              format_func=lambda i: submission_names[i])
                    
                    if selected_idx is not None:
                        selected_id = submission_ids[selected_idx]
                        entry = filtered_df[filtered_df['id'] == selected_id].iloc[0]
                        
                        detail_col1, detail_col2 = st.columns(2)
                        with detail_col1:
                            # Display plant name and privacy status
                            title_col, status_col = st.columns([3, 1])
                            with title_col:
                                st.subheader(f"{entry['plant_name']}")
                            with status_col:
                                if pd.notna(entry['consent']) and entry['consent'] == 'No, keep private':
                                    st.warning("ЁЯФТ Private")
                                else:
                                    st.success("ЁЯМН Public")
                            
                            if pd.notna(entry['entry_title']):
                                st.write(f"**Title:** {entry['entry_title']}")
                            st.write(f"**Scientific Name:** {entry['scientific_name']}")
                            st.write(f"**Categories:** {entry['category']}")
                            st.write(f"**Local Names:** {entry['local_names']}")
                            st.write(f"**Community:** {entry['community']}")
                            st.write(f"**Location:** {entry['location']}")
                            st.write(f"**Submitted By:** {entry['submitter_name'] if pd.notna(entry['submitter_name']) else 'Anonymous'}")
                            st.write(f"**Date:** {entry['submission_time']}")
                
                            with detail_col2:
                                if pd.notna(entry['photo_path']) and os.path.exists(entry['photo_path']):
                                    st.image(entry['photo_path'], caption="Plant Photo")
                            
                            st.subheader("Description")
                            st.write(f"**Usage:** {entry['usage_desc']}")
                            st.write(f"**Preparation:** {entry['prep_method']}")
                            
                            # Display contributor information if available
                            if pd.notna(entry['age_group']) or pd.notna(entry['submitter_role']):
                                st.subheader("Contributor Information")
                                if pd.notna(entry['age_group']):
                                    st.write(f"**Age Group:** {entry['age_group']}")
                                if pd.notna(entry['submitter_role']):
                                    st.write(f"**Role:** {entry['submitter_role']}")
                                if pd.notna(entry['submitter_name']) and entry['submitter_name'] != entry['submitter_name']:
                                    st.write(f"**Name:** {entry['submitter_name']}")
                                # Contact info is only displayed to the owner of the submission
                                current_user_id = st.session_state.user_info['id'] if 'user_info' in st.session_state else None
                                
                                # Show privacy status and contact info if authorized
                                if pd.notna(entry['consent']):
                                    st.write(f"**Consent:** {entry['consent']}")
                                    
                                # Only show contact info to the owner of the submission
                                if current_user_id and str(current_user_id) == str(entry.get('user_id')):
                                    if pd.notna(entry['contact_info']):
                                        st.write(f"**Contact:** {entry['contact_info']}")
                            
                            # Display other media if available
                            st.subheader("Attachments")
                            if pd.notna(entry['voice_path']) and os.path.exists(entry['voice_path']):
                                st.write("**Voice Recording:**")
                                st.audio(entry['voice_path'])
                            
                            if pd.notna(entry['notes_path']) and os.path.exists(entry['notes_path']):
                                if entry['notes_path'].endswith('.pdf'):
                                    st.write(f"[View PDF Notes]({entry['notes_path']})")
                                else:
                                    st.image(entry['notes_path'], caption="Scanned Notes")

                # Download link for the CSV file
                def download_link(df, file_name):
                    csv_df = df[['id', 'plant_name', 'entry_title', 'scientific_name', 'category', 
                               'local_names', 'usage_desc', 'prep_method', 'location', 'submission_time']]
                    csv = csv_df.to_csv(index=False)
                    b64 = base64.b64encode(csv.encode()).decode()
                    href = f'<a href="data:file/csv;base64,{b64}" download="{file_name}">Download CSV File</a>'
                    return href
                
                st.markdown(download_link(filtered_df, "plantspeak_filtered_data.csv"), unsafe_allow_html=True)
                
            else:
                st.info("No submissions in the database yet. Add your first plant knowledge entry using the 'Add New Entry' tab.")
                
                # Try to import existing CSV data if available
                if os.path.exists("plantspeak_submissions.csv"):
                    st.info("Legacy CSV data found. Would you like to import it to the database?")
                    if st.button("Import CSV Data to Database"):
                        with st.spinner("Importing data..."):
                            try:
                                csv_df = pd.read_csv("plantspeak_submissions.csv")
                                import_count = 0
                                
                                for _, row in csv_df.iterrows():
                                    # Map CSV columns to database fields
                                    submission_id = row.get('ID', str(uuid.uuid4())[:8])
                                    user_id = row.get('User ID', None)
                                    
                                    db_save_success = save_submission_to_db(
                                        submission_id, user_id, row.get('Time', datetime.now().strftime("%Y-%m-%d %H:%M:%S")),
                                        row.get('Plant Name', ''), row.get('Entry Title', ''), 
                                        row.get('Local Names', ''), row.get('Scientific Name', ''),
                                        row.get('Category', ''), row.get('Usage Description', ''), 
                                        row.get('Preparation Method', ''), row.get('Community', ''), 
                                        row.get('Tags', ''), row.get('Location', ''), row.get('Language', ''),
                                        row.get('Latitude', 0.0), row.get('Longitude', 0.0),
                                        row.get('Photo Path', ''), row.get('Voice Path', ''), 
                                        row.get('Notes Path', ''), row.get('Age Group', ''),
                                        row.get('Role', ''), row.get('Name', ''),
                                        row.get('Contact', ''), row.get('Consent', '')
                                    )
                                    
                                    if db_save_success:
                                        import_count += 1
                                
                                st.success(f"Successfully imported {import_count} submissions from CSV to the database!")
                                st.rerun()
                            except Exception as e:
                                st.error(f"Error importing data: {e}")

def update_user_profile(user_id, name=None, email=None, role=None, community=None, password=None):
    """Update user profile information in the database"""
    conn = sqlite3.connect('plantspeak.db')
    c = conn.cursor()
    
    update_fields = []
    params = []
    
    # Build the update query based on which fields are provided
    if name is not None:
        update_fields.append("name = ?")
        params.append(name)
    if email is not None:
        update_fields.append("email = ?")
        params.append(email)
    if role is not None:
        update_fields.append("role = ?")
        params.append(role)
    if community is not None:
        update_fields.append("community = ?")
        params.append(community)
    if password is not None:
        update_fields.append("password = ?")
        params.append(hash_password(password))
    
    # If there are fields to update
    if update_fields:
        # Add user_id to the params
        params.append(user_id)
        
        query = f"UPDATE users SET {', '.join(update_fields)} WHERE id = ?"
        
        try:
            c.execute(query, params)
            conn.commit()
            success = True
        except sqlite3.IntegrityError as e:
            # Most likely due to duplicate email
            print(f"Database update error: {e}")
            success = False
        finally:
            conn.close()
        
        return success
    
    conn.close()
    return False  # No fields to update
